<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<script src="/resources/js/jquery.min.js"></script>
<script src="/resources/js/bootstrap.min.js"></script>

<head>
  <title>프로찾기</title>
</head>
<script>


//검색 하기
$("#spcltyB").on("click",function(){
	let spcltyRealmNm = $(this).val();
	let spcltyOptions = "";
	
	$.ajax({
		type:"GET",
		url:"/proSearch/getSpclty",
		data:{spRealNm: spRealNm},
		success: function(data){
			$.each(data, function(index, list){
				spcltyOptions += '<p>"'+list.spRealNm+'"</p>';
			});
			$("#spRealNm").html(spcltyOptions);
		}
	});
});

$(function(){
	$("#searchProBtn").on("click",function(){
		let currentPage="1";
		$("#proListBody").html(""); 
		console.log("keyword : " + $("#keyword").val());
		let key = $("#keyword").val();
		let data = {
				"currentPage":currentPage,
				"keyword":key
		}
		console.log("data : ", data);
		proList(data);
		let url = "/proSearch/proList?currentPage=" + currentPage + "&keyword=" + key;
		window.location.href = url;
	});
});

//검색한 프로 찾기
function proList(data){
    $.ajax({
        type: "post",
        url: "/proSearch/searchPage",
        data: JSON.stringify(data),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(res){
            console.log(res);
            
            let str = "";
            if(res.content == null || res.content.length === 0){
            	str += "<div style='text-align: center;'>";
            	str += "<img src='../resources/images/우는모양.png' style='width:100px; height:100px; '/>";
            	str += "<h3 style='padding:20px 0 40px 0; color:#c6c9cc;'><b>검색 결과가 없어요!</b></h3>";
            	str += "</div>";
            }else{
            $.each(res.content, function(idx, ProVO){
                console.log("ProVO[" + idx + "] : ", ProVO);
                console.log("res : " , res.content);
                str += "<div style='border: 1px solid #CED4DA; border-radius: 20px; width: 800px; margin-left: 280px; padding: 10px 0;'>";
                str += "<div style='display: flex; align-items: center; margin-left: 100px;' >";
                str += "<div style='width: 500px;'>";
                str += "<div style='display: flex; align-items: center;'>";
                str += "<div style='width: 200px;'>";
                str += "<h3>"+ProVO.userSeVOList[0].userNcnm+"</h3>";
                str += "<p>"+ProVO.proId+"</p>";
                str += "</div>";
                str += "<div style='width: 300px;'>";
                str += "<p class='spcltyRealm' style='border: 1px solid #CED4DA; border-radius: 20px; display: inline-block;'>&nbsp&nbsp"+ProVO.spcltyRealmVOList[0].spcltyRealmNm+"&nbsp&nbsp</p>";
                str += "<p style='border: 1px solid #CED4DA; border-radius: 20px; display: inline-block;'>&nbsp;&nbsp;"+ProVO.proflVOList[0].proProflContactPosblTime+"&nbsp;&nbsp;</p>";
                str += "<p class='profl-info' style='border: 1px solid #CED4DA; border-radius: 20px; display: inline-block;'>";
                str += "&nbsp;&nbsp;<span class='bcityNm'>"+ProVO.vcityVOList[0].bcityNm+"</span>&nbsp;";
                str += "<span class='brtcNm'>"+ProVO.vcityVOList[0].brtcNm+"</span>&nbsp;&nbsp;";
                str += "</p>";
                str += "</div>";
                str += "</div>";
                str += "<div>";
                str += "<p>"+ProVO.proflVOList[0].proProflOnLiIntrcn+"</p>";
                str += "</div>";
                str += "</div>";
                str += "<div style='margin-left: 20px;'>";
                str += "<img class='proProflPhoto' src='"+ (ProVO.proProflPhoto == null ? '/images/2024/profile.jpg' : ProVO.proProflPhoto) +"' style='width: 100px; height: 100px; border-radius: 20%;'> ";  
                str += "</div>";
                str += "</div>";
                str += "</div>";
                str += "<br><br>";
            });
            
            }
            $("#proListBody").html(str); 
            $("#keyword").val("");
            
            //페이징처리
            if(res.content == null || res.content.length === 0){
            	$("#S_divPaging").html("");
            }else{            	
            	$("#S_divPaging").html(res.pagingArea);
            }
        }
    });
}

//전체
$(function(){
	let currentPage = "${param.currentPage}"
	if(currentPage == "") {
		currentPage = "1";
	}
	let data = {
		"keyword": "${param.keyword}",
		"currentPage": currentPage
	};
	console.log("data : " + data);
	proList(data);

});
</script>


<div>
	<h1 style="text-align:center;">프로 찾기</h1>
	<br>
	<span style="display:flex; justify-content: center; margin-left:80px;">
		<input id="keyword" style="width:400px; height:40px; padding: 0 20px 0 20px; border:1px solid #c4c4c4; border-radius: 20px;">
		<button id="searchProBtn" class="btn btn-primary" type="button" style="margin-left: 10px;">검색</button>
	</span>
	<hr style="border-width:1px 0 0 0 0; border-style:solid; border-color:#CED4DA; width:1000px; margin: 30px auto;">

	<div>
		<div>
			<div  style="display:flex; align-items: center; justify-content: center;">
				<div>
					<button class="btn btn-outline-primary btn-fw" type="button" style="margin-right: 10px;" data-toggle="modal" data-target="#serModal">서비스</button>
					<button class="btn btn-outline-primary btn-fw" type="button" style="margin-right: 10px;" data-toggle="modal" data-target="#cityModal">지역</button>
				</div>
				<p class="card-description" style="margin:0 0 0 170px;">
		  		회원님만의 눈에띄는 프로를 찾아보세요!
				</p>
			</div>
			<br>
			
  			<div id="proListBody">
			<!--  proSearchList : [ProVO(proId=asdasd, proProflPhoto=/images/2024/03/15/c192873a-de59-47ac-8221-0f46f42412af_Anne-Marie(앤마리)-2002.jpg, spcltyRealmCode=SR2502, 
			proflVOList=[ProProflVO(proProflOnLiIntrcn=dasfd, proProflContactPosblTime=asdfasd, bcityCode=11, brtcCode=11090)], 
			userSeVOList=[UsersVO(userNcnm=asdasd)], 
			vCityVOList=[VCityVO(bcityNm=서울, brtcNm=강북구, ], 
			spcltyRealmVOList=[SpcltyRealmVO(spcltyRealmNm=태권도)]), -->
			<c:if test=""></c:if>
			</div>
    	</div>
		<div id="S_divPaging" style="position: relative; margin-left: 45%; margin-top: 20px;">
		</div>
	</div>
</div>


<!-- //////// 서비스 선택 모달 //////// -->
<div class="modal fade" id="serModal" tabindex="-1" aria-labelledby="exampleModalLabel-2" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="serModalTitle">서비스별 검색하기</h5>
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="serModalBody" style="height:auto;">
				<div class="form-group">
		
<c:forEach items="${spcltyBList}" var="spcltyBVO" varStatus="loop">
    <div class="mt-4">
        <div class="accordion accordion-solid-header" id="accordion-${loop.index}" role="tablist">
            <div class="card">
                <div class="card-header" role="tab" id="heading-${loop.index}">
                    <h6 class="mb-0">
                        <a id="spcltyB-${loop.index}" data-bs-toggle="collapse" href="#collapse-${loop.index}" aria-expanded="false" aria-controls="collapse-${loop.index}">
                            ${spcltyBVO.spcltyRealmNm}
                        </a>
                    </h6>
                </div>
                <div id="collapse-${loop.index}" class="collapse" role="tabpanel" aria-labelledby="heading-${loop.index}" data-parent="#accordion-${loop.index}" style="">
                    <div class="card-body">
                        <div class="accordion" id="accordion-${loop.index}-sub" role="tablist">
                            <div class="card">
                                <div class="card-header" role="tab" id="heading-${loop.index}-sub-1">
                                    <h6 class="mb-0">
                                        <a id="spcltyB-${loop.index}-sub-1" data-bs-toggle="collapse" href="#collapse-${loop.index}-sub-1" aria-expanded="false" aria-controls="collapse-${loop.index}-sub-1">
                                            중분류 1
                                        </a>
                                    </h6>
                                </div>
                                <div id="collapse-${loop.index}-sub-1" class="collapse" role="tabpanel" aria-labelledby="heading-${loop.index}-sub-1" data-parent="#accordion-${loop.index}-sub" style="">
                                    <div class="card-body">
                                        소분류 1
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</c:forEach>
				</div> 
			</div>
			
			<div class="modal-footer" style="border-top:none;">
				<button class="btn btn-primary" type="submit" id="serSub" >확인</button>
				<button type="button" class="btn btn-light" data-dismiss="modal">닫기</button>
			</div>
		</div>
	</div>
</div>



<!-- //////// 지역 선택 모달 //////// -->
<div class="modal fade" id="cityModal" tabindex="-1" aria-labelledby="exampleModalLabel-2" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="cityModalTitle">서비스별 검색하기</h5>
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="cityModalBody">
<%-- 				<div class="form-group">
					<label for="bcityNm">지역(광역시)</label>
						<select id="bcityNm" name="bcityNm" class="form-control">
							<option selected>지역(광역시)</option>
							<c:forEach items="${bcityVOList}" var="bcityVO">
				<option><c:out value="${bcityVO.bcityNm}"/></option>
				</c:forEach>
						</select>
					</div> 
				<div class="form-group">
				    <label for="brtcNm" style="margin-left:15px;">지역(시/구)</label>
				<select id="brtcNm" name="brtcNm" class="form-control" style="width:200px; margin-left:15px;">
					    <option selected>지역(시/구)</option>
					</select>
				</div> --%>
			</div>
			
			<div class="modal-footer">
				<button class="btn btn-primary" type="submit" id="citySub" >확인</button>
				<button type="button" class="btn btn-light" data-dismiss="modal">닫기</button>
			</div>
		</div>
	</div>
</div>
