<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<script type="text/javascript" src="/resources/js/jquery-3.6.0.js"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
//구글 차트 라이브러리를 로딩
google.load("visualization","1",{"packages":["corechart"]});

//불러오는 작업이 완료되어 로딩이 되었다면 drawChart() 함수를 호출하는 콜백이 일어남
google.setOnLoadCallback(drawChart);

$("#sel1").on("change",function(){
	let gubun = $("#sel1").val();
	console.log("gubun : " + gubun);
	
	let jsonData = $.ajax({
		url:"/chart/chart02?gubun="+gubun,
		dataType:"json",
		async:false
	}).responseText;
	
	console.log("jsonData : ", jsonData);
	
	//구글 차트용 데이터 테이블 생성
	let data = new google.visualization.DataTable(jsonData);
	
	//어떤 차트 모양으로 출력할지를 정해주자 => LineChart
	//LineChart , ColumnChart, PieChart
	let chart = new google.visualization.LineChart(
		document.getElementById("chart_div")	
	);
	
	//data 데이터를 chart 모양으로 출력해보자
	chart.draw(data,
		{
			title:"차트 예제",
			width:500,
			height:400
		}	
	);	
});

//콜백함수
function drawChart(){
	//아작났어유
	//dataType : 응답데이터의 형식
	//contentType : 보내는데이터의 형식
	//sync : 동기 / async : 비동기
	//gubun=vegetable
	//gubun=fruit
	let jsonData = $.ajax({
		url:"/chart/chart02?gubun=fruit",
		dataType:"json",
		async:false
	}).responseText;
	
	console.log("jsonData : ", jsonData);
	
	//구글 차트용 데이터 테이블 생성
	let data = new google.visualization.DataTable(jsonData);
	
	//어떤 차트 모양으로 출력할지를 정해주자 => LineChart
	//LineChart , ColumnChart, PieChart
	let chart = new google.visualization.LineChart(
		document.getElementById("chart_div")	
	);
	
	//data 데이터를 chart 모양으로 출력해보자
	chart.draw(data,
		{
			title:"차트 예제",
			width:500,
			height:400
		}	
	);	
}
</script>

<div class="card card-success">
	<div class="card-header">
		<h3 class="card-title">Bar Chart</h3>
		<div class="card-tools">
			<button type="button" class="btn btn-tool"
				data-card-widget="collapse">
				<i class="fas fa-minus"></i>
			</button>
			<button type="button" class="btn btn-tool" data-card-widget="remove">
				<i class="fas fa-times"></i>
			</button>
		</div>
	</div>
	<div class="card-body">
		<div class="chart">
			<div class="chartjs-size-monitor">
				<div class="chartjs-size-monitor-expand">
					<div class=""></div>
				</div>
				<div class="chartjs-size-monitor-shrink">
					<div class=""></div>
				</div>
			</div>
			<canvas id="barChart"
				style="min-height: 250px; height: 250px; max-height: 250px; max-width: 100%; display: block; width: 312px;"
				width="374" height="300" class="chartjs-render-monitor"></canvas>
		</div>
	</div>

</div>

