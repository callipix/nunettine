<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<script src="/resources/js/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<div class="col-12">
	<div class="card">
		<div class="card-body">
			<h3 class="card-title">${vSrvcRequstVO.srvcRequstSj}</h3>
			<p class="card-description"><fmt:formatDate pattern="yyyy-MM-dd HH:mm" value="${vSrvcRequstVO.srvcRequstWrDt}"/></p>
			<hr />
			<div class="row">
				<div class="col-md-10 mx-auto">
					<div class="tab-content tab-content-custom-pill" id="pills-tabContent-custom">
						<form id="srvcRqDetailFrm" action="/srvcRequst/acceptRequst" method="post" >
							<!-- 요청서 본문 -->
							<input type="hidden" id="srvcRequstNo" name="srvcRequstNo" value="${vSrvcRequstVO.srvcRequstNo}" />
							<div>
								<!-- 요청서 이미지 -->
								<div class="d-flex mb-4" id="srvcRequstImages">
									<c:forEach var="sprviseAtchmnflVO" items="${vSrvcRequstVO.sprviseAtchmnflVOList}" varStatus="status">
										<img alt="sample image" src="${sprviseAtchmnflVO.atchmnflCours}"
											 style="width: 150px; height: 130px; border-radius: 20%; margin-right: 10px;">
									</c:forEach>
								</div>
								<p id="srvcRequstCn">${vSrvcRequstVO.srvcRequstCn}</p>
							</div>
						</form>
						<!-- 거절사유 -->
						<c:if test="${vSrvcRequstVO.srvcRequstItyy != null}">
							<hr />
							<div class="mb-3 srvcRequstItyy">
					            <label for="srvcRequstItyy" class="col-form-label">거절 사유</label>
				    	        <div class="form-control" id="srvcRequstItyy">${vSrvcRequstVO.srvcRequstItyy}</div>
				         	</div>
						</c:if>
					</div>
				</div>
			</div>
         	<hr />
        	<!-- 버튼 -->
         	<div>
				<button type="button" class="btn btn-inverse-secondary clsBtn">닫기</button>
				<c:if test="${vSrvcRequstVO.srvcRequstProcessAt == 0 && vSrvcRequstVO.emplyrTy == 'ET02'}">
					<button type="button" class="btn btn-inverse-primary" onclick="confirmBtn('1')">수락</button>
					<button type="button" class="btn btn-inverse-danger btn-icon-text btn-popover"
        				popovertarget="reject-popover">거절</button>
				</c:if>
			</div>
		</div>
	</div>
</div>
<!-- 수락 모달 -->
<div class="modal fade" id="acceptChkModal" tabindex="-1" 
	aria-labelledby="exampleModalLabel-2" aria-hidden="true">
	<div class="modal-dialog modal-sm" role="document">
		<div class="modal-content"">
			<div class="modal-body">
				<img alt="small image" src="/resources/images/alert_warning.png" style="width:100px;">
				<h2 id="chkMsg"></h2>
				<h4>선택 완료 시, 변경이 불가합니다.</h4>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-inverse-primary" id="acceptBtn" style="display:none;">확인</button>
				<button type="button" class="btn btn-inverse-primary" id="rejectSuccessBtn" style="display: none;">확인</button>
				<button type="button" class="btn btn-light" data-dismiss="modal" id="chkClsBtn">Cancel</button>
			</div>
		</div>
	</div>
</div>
<!-- 거절 모달 -->
<div id="reject-popover" popover 
	style="border: 0px; border-radius:5px; position: relative; margin-left:29%; margin-top:30%;">
	<div class="card-body">
		<h4 class="card-title">거절 사유를 선택해주세요.</h4>
		<p class="card-description">
			거절 사유는 회원에게 그대로 전달되며, 완료 후 수정이 불가합니다.
		</p>
		<form action="/srvcRequst/rejectRequst" method="post" id="rejectRequstFrm">
			<div class="row">
				<div class="col-md-6">
					<div class="form-group">
						<div class="form-check">
							<label class="form-check-label"> 
							<input type="checkbox" class="form-check-input" name="srvcRequstItyy" id="srvcRequstItyy"
								value="시간이 맞지 않아요" />시간이 맞지 않아요
							<i class="input-helper"></i></label>
						</div>
						<div class="form-check">
							<label class="form-check-label">
							 <input type="checkbox" class="form-check-input" name="srvcRequstItyy" id="srvcRequstItyy"
							 	value="분야가 맞지 않아요" /> 분야가 맞지 않아요 
							 <i	class="input-helper"></i>
							 </label>
						</div>
						<div class="form-check">
							<label class="form-check-label">
							 <input type="checkbox" class="form-check-input" name="srvcRequstItyy" id="srvcRequstItyy"
							 	value="가격대가 맞지 않아요" /> 가격이 맞지 않아요
							 <i	class="input-helper"></i>
							 </label>
						</div>
						<div class="form-check">
							<label class="form-check-label">
							 <input type="checkbox" class="form-check-input" id="other" name="srvcRequstItyy"
							 	value="기타" /> 기타
							 <i	class="input-helper"></i>
							 </label>
						</div>
						<input type="text" class="form-control" id="srvcRequstItyyInput" name="srvcRequstItyyInput" style="display: none;"/>
					</div>
				</div>
				<input type="hidden" id="rejectSrvcRequstNo" name="rejectSrvcRequstNo" value="${vSrvcRequstVO.srvcRequstNo}" />
			</div>
			<button type="button" class="btn btn-inverse-primary btn-sm" onclick="confirmBtn('2')" popovertarget="reject-popover" popovertargetaction="hide">거절</button>
			<button type="button" class="btn btn-inverse-secondary btn-sm"
				popovertarget="reject-popover" popovertargetaction="hide">닫기</button>
		</form>
	</div> 
</div>
<script>
$(".clsBtn").on("click",function(){
	window.location.href="/srvcRequst/srvcRqList";
});

$("#chkClsBtn").on("click",function(){
	
});


function confirmBtn(no){
	if(no ==1){
	    Swal.fire({
	        title: "요청을 수락하시겠습니까?",
	        text: "선택 완료 후 변경은 불가합니다.",
	        icon: "question",
	        showCancelButton: true,
	    }).then((result) => {
	        if (result.isConfirmed) {
	            Swal.fire({
	                title: "수락을 완료하였습니다!",
	                icon: "success"
	            }).then(() => {
	                $("#srvcRqDetailFrm").submit();
	            });
	        }
	    });
	    $(".swal2-question").css("margin-top", "20px");
		$(".swal2-question").css("margin-bottom", "10px");
		$(".swal2-warning").css("margin-top", "20px");
		$(".swal2-warning").css("margin-bottom", "10px");
		$(".swal2-icon").css("margin-bottom", "10px");
	    
	}else if(no == 2){
		$("#reject-popover").attr("popovertargetaction","hide");
	    Swal.fire({
	        title: "요청을 거절하시겠습니까?",
	        text: "선택 완료 후 변경은 불가합니다.",
	        icon: "warning",
	        showCancelButton: true,
	    }).then((result) => {
	        if (result.isConfirmed) {
	            Swal.fire({
	                title: "거절을 완료하였습니다.",
	                icon: "success",
	            }).then(() => {
	            	$("#rejectRequstFrm").submit();
	            });
	        }
	    });
		$(".swal2-question").css("margin-top", "20px");
		$(".swal2-question").css("margin-bottom", "10px");
		$(".swal2-warning").css("margin-top", "20px");
		$(".swal2-warning").css("margin-bottom", "10px");
		$(".swal2-success").css("margin-bottom", "10px");
	}
}

$('input[type="checkbox"][name="srvcRequstItyy"]').click(function(){
	if($(this).prop('checked')){
		$('input[type="checkbox"][name="srvcRequstItyy"]').prop('checked',false);
		$(this).prop('checked', true);
		srvcRequstItyy = $('input[type="checkbox"][name="srvcRequstItyy"]:checked').val();
		
		 if($('#other').prop('checked')){
	            $("#srvcRequstItyyInput").css("display","block");
	        } else {
	            $("#srvcRequstItyyInput").css("display","none");
	        }
	}
});
</script>

