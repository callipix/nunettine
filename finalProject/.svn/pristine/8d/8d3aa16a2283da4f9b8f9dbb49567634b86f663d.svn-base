<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<html>
<head>

<style>
#roomWrap {
    width: 200px;
}
#allRoom {
    width: 200px;
}

#roomList {
    border: 1px solid #0084FF;
    border-radius: 5px;
}

#roomHeader {
    background-color: #0084FF;
    color: #fff;
    height: 40px;
    font-size: 18px;
    line-height: 40px;
    text-align: center;
    border-radius: 5px;
}

.roomEl {
    text-align: center;
    border-bottom: 1px solid #f0f0f0;
    padding: 10px 0px;
    cursor: pointer;
}

.roomEl:hover{
    background: #f0f0f0;
}

.roomEl.active{
    background: #f0f0f0;
}
#chatWrap {
    width: 600px;
    border: 1px solid #ddd;
}

#chatHeader {
    height: 60px;
    text-align: center;
    line-height: 60px;
    font-size: 25px;
    font-weight: 900;
    border-bottom: 1px solid #ddd;
}

#chatLog {
    height: 700px;
    overflow-y: auto;
    padding: 10px;
}

.myMsg {
    text-align: right;
}

.anotherMsg {
    text-align: left;
    margin-bottom: 5px;
}

.msg {
    display: inline-block;
    border-radius: 15px;
    padding: 7px 15px;
    margin-bottom: 10px;
    margin-top: 5px;

}

.anotherMsg > .msg {
    background-color: #f1f0f0;

}

.myMsg > .msg {
    background-color: #0084FF;
    color: #fff;
}

.anotherName {
    font-size: 12px;
    display: block;
}

#chatForm {
    display: block;
    width: 100%;
    height: 50px;
    border-top: 2px solid #f0f0f0;
}

#message {
    width: 85%;
    height: calc(100% - 1px);
    border: none;
    padding-bottom: 0;
}

#message:focus {
    outline: none;
}

#chatForm > input[type=submit] {
    outline: none;
    border: none;
    background: none;
    color: #0084FF;
    font-size: 17px;
}
#memberWrap{
    width: 200px;
}

#myRoomList{
    width: 200px;
}

#memberList {
    border: 1px solid #aaaaaa;
    border-radius: 5px;
}

#memberHeader {
    height: 40px;
    font-size: 18px;
    line-height: 40px;
    padding-left: 15px;
    border-bottom: 1px solid #f0f0f0;
    font-weight: 600;
}

.memberEl {
    border-bottom: 1px solid #f0f0f0;
    padding: 10px 20px;
    font-size: 14px;
}
#contentCover{
/*     width: 1280px; */
    margin: 0 auto;
    padding-top: 20px;
    display: flex;
    justify-content: space-around;
}
</style>
<body>
<!-- <div> -->
	<div>
		<div id="contentCover">
		<div id="">
		    <div id="roomWrap">
		        <div id="">
		            <div id="roomHeader">채팅 방 목록</div>
		            <ul>
		                <c:forEach var="roomVO" items="${allRoomList}" varStatus="stat">
								<a href="<c:url value='/chat/joinRoom'><c:param name='roomNo' value='${roomVO.roomNo}'/></c:url>"
									onclick="allRoomList(event , '${roomVO.roomNo}')">${roomVO.roomName}
									</a>
		                        <br>
		                        <span>방번호: ${roomVO.roomNo}</span> | 
		                </c:forEach>
		            </ul>
		        </div>
		    </div>
		     <div id="roomWrap">
              <div id="myroomlist">
                  <div id="roomHeader">내방목록</div>
                  <ul>
                      <c:forEach var="myRoomVO" items="${myRoomList}" varStatus="stat"><br>
	                          <a href="<c:url value='/chat/join'><c:param name='roomNo' value='${myRoomVO.roomNo}'/></c:url>"
	                           onclick="join('${myRoomVO.roomNo}')"> ${myRoomVO.roomName}</a>
	                  </c:forEach>
<%--                               <c:param name="roomNo" value="${myRoomVO.roomNo}"/> --%>
<%--                           <span>방번호: ${myRoomVO.roomNo}</span> --%>

                  </ul>
              </div>
          </div>
		    </div>
		    <div id="roomWrap">
    <div id="roomList">
        <div id="roomHeader">내 방에 존재하는 유저 리스트</div>
        <ul>
            <c:forEach var="room" items="${myRoomList}">
                <li>
                    <span>방번호: ${room.roomNo}</span>
                    <ul>
                        <c:forEach var="user" items="${room.userVO}" varStatus="stat">
                            <li>
                                <a href="<c:url value='/chat/start'> 
                                    <c:param name='userId' value='${user.userId}'/></c:url>"
                                    onclick="choice2()">${user.userId}</a>
                            </li>
                        </c:forEach>
                    </ul>
                </li>
            </c:forEach>
        </ul>
    </div>
</div>
		</div>
    </div>
<script>
function allRoomList(event , roomNo){
	event.preventDefault();
	
	if(confirm("방에 참가하시겠습니까?")){
		
	} else {
		alert("참가실패")
		return;
	};
	$.ajax({
		method : "post",
        url : "http://localhost:8080/chat/joinCheck",
        contentType : "application/json",
        data : roomNo,
        dataType : "text",
		success : function(result){
			if(result == 1){
				console.log("참가중" , result);
				alert("이미 참가중인 방입니다 방으로 이동합니다");
				location.href = "http://localhost:8080/chat/join?roomNo="+roomNo;
// 				joinRoom(roomNo);
				return;
			} else {
				if(confirm("참가중인 채팅방이 아닙니다. 참가하시겠습니까? ")){
// 					location.href = "http://localhost:8080/chat/join?=roomNo"+roomNo;			
				} else {
					return;
				}
			}
		}
	})
}
function join(roomNo){
// 	event.preventDefault(); // 기본 이벤트(링크 이동)를 막음
// 	console.log("roomNo " + roomNo)
// 	if(confirm("채팅방에 참가하시겠습니까?")){
// 	}
// 	console.log("roomNo " + roomNo)
		
// 	$.ajax({
// 			type : "get",
// 			url : "http://localhost:8080/chat/join",
// 			contentType : "application/json",
// 			data : {"roomNo" : roomNo},
// 			dataType : "text",
// 			success : function(result){
// 				console.log("result" , result);
// 			},
// 		})
// 	} else {
// 		console.log("취소 동작? ");
// 		return;
// 	}
//     location.href = "http://localhost:8080/chat/join?=roomNo" + roomNo;
}
</script>
</body>
</head>
</html>