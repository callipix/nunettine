<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<script src="/resources/js/jquery.min.js"></script>

<div class="card">
	<div class="card-body">
		<h4 class="card-title">사전문의</h4>
		<p class="card-description">
			<div class="dropdown show">
            	<button class="btn btn-secondary btn-sm dropdown-toggle" type="button" id="dropdownMenuSizeButton3" 
                      	data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"> 선택
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuSizeButton3" style="position: absolute; will-change: transform; top: 0px; left: 0px; transform: translate3d(0px, 31px, 0px);" x-placement="bottom-start">
                	<p class="dropdown-item">닉네임</p>
                    <p class="dropdown-item">제목</p>
                    <p class="dropdown-item">미답변</p>
                    <p class="dropdown-item">답변 완료</p>
                </div>
             </div>
<!-- 			<input type="text" id="searchKeyword"> -->
		</p>
		<div class="table-responsive">
			<table class="table" style="text-align: center;">
				<thead>
					<tr>
						<th>번 호</th>
						<th>문의자 명</th>
						<th>제 목</th>
						<th>진행상태</th>
						<th>문의일자</th>
					</tr>
				</thead>
				<tbody>
					<!-- 
					srvcBtfInqryVOList :[SrvcBtfInqryVO(num=1, btfInqryNo=0, mberId=null, btfInqrySj=사전문의랑 첨부파일도 드려요,
					 btfInqryCn=null, btfInqryWrDt=Thu Mar 07 18:28:39 KST 2024, btfInqryAnswerCn=null, 
					 btfInqryAnswerWrDt=null, sprviseAtchmnflNo=0, proId=testPro)]
					 -->
					<c:forEach var="vSrvcBtfInqryVO" items="${vSrvcBtfInqryVOList}" varStatus="status">
						
						<!-- 회원의 보낸 사전 문의 목록 -->
						<c:choose>
							<c:when test='${vSrvcBtfInqryVO.emplyrTy.equals("ET02")}'>
								<tr id="btfInqry${vSrvcBtfInqryVO.btfInqryNo}" onclick="javascript:btfInqryDetail('${vSrvcBtfInqryVO.btfInqryNo}','${vSrvcBtfInqryVO.userNm}')">
								<td>${vSrvcBtfInqryVO.num}</td>
								<td>${vSrvcBtfInqryVO.userNm}</td>
								<td>${vSrvcBtfInqryVO.btfInqrySj}</td>
								<c:choose>
									<c:when test="${vSrvcBtfInqryVO.btfInqryAnswerCn==null}">
										<td><label class="badge badge-secondary">진행 중</label></td>								
									</c:when>
									<c:when test="${vSrvcBtfInqryVO.btfInqryAnswerCn!=null}">
										<td><label class="badge badge-info">답변완료</label></td>								
									</c:when>
								</c:choose>
								<td><fmt:formatDate pattern="yyyy-MM-dd" value="${vSrvcBtfInqryVO.btfInqryWrDt}"/> </td>
							</c:when>
							
							<%-- 프로의 받은 사전 문의 목록 --%>
							<c:when test='${vSrvcBtfInqryVO.emplyrTy.equals("ET01")}'>
								<tr id="btfInqry${vSrvcBtfInqryVO.btfInqryNo}" onclick="javascript:btfInqryDetail('${vSrvcBtfInqryVO.btfInqryNo}','${vSrvcBtfInqryVO.userNm}')">
								<td>${vSrvcBtfInqryVO.num}</td>
								<td>${vSrvcBtfInqryVO.userNm}</td>
								<td>${vSrvcBtfInqryVO.btfInqrySj}</td>
								<c:choose>
									<c:when test="${vSrvcBtfInqryVO.btfInqryAnswerCn==null}">
										<td><label class="badge badge-danger">미답변</label></td>								
									</c:when>
									<c:when test="${vSrvcBtfInqryVO.btfInqryAnswerCn!=null}">
										<td><label class="badge badge-info">답변완료</label></td>								
									</c:when>
								</c:choose>
								<td><fmt:formatDate pattern="yyyy-MM-dd" value="${vSrvcBtfInqryVO.btfInqryWrDt}"/></td>
							</c:when>
						</c:choose>
					</tr>
					</c:forEach>
				</tbody>
			</table>
		</div>
	</div>
</div>

<!-- 상세 모달 -->
<div class="detailModal" >
	<div class="card">
		<div class="card-body">
			<h4 class="card-title">사전문의 상세 보기</h4>
			<p class="" id="userNm"></p>
			<p id="btfInqryWrDt"><p>
			<form class="forms-sample">
				<div class="form-group">
					<label for="btfInqrySj">제목</label>
					<input type="text" class="form-control" id="btfInqrySj">
				</div>
				<div class="form-group">
					<label for="btfInqryCn">내용</label>
					<div class="form-control" id="btfInqryCn"> 
					</div>
				</div>
				<div class="form-group">
					<label for="btfInqryAnswerCn">답변</label>
					<p id="btfInqryAnswerWrDt"></p>
					<div class="form-control" id="btfInqryAnswerCn">
					</div>
				</div>
				<button class="btn btn-light" id="cancelBtn">닫기</button>
			</form>
		</div>
	</div>
</div>

<script>
// 상세 모달 보기 
function btfInqryDetail(no, nm){
	var btfInqryNo = no;
	var userNm = nm;
	console.log("번호", btfInqryNo);	
	console.log("닉네임", userNm);	
	
	$.ajax({
		url :"/srvcBtfInqry/btfInqryDetail?btfInqryNo="+no,
		type : "get",
		contentType : "application/json;charset=utf-8",
		data : {"btfInqryNo" : btfInqryNo},
		dataType : "json",
		success : function(res){
			console.log("res", res);
			console.log("제목", res.btfInqrySj);
			console.log("작성시간 ", res.btfInqryWrDt);
			console.log("답글시간", res.btfInqryAnswerWrDt);
			// 문의자 닉네임
			$("#userNm").text(userNm);
			// 문의 작성 시간 
			$("#btfInqryWrDt").text(res.btfInqryWrDt);
			// 문의 제목
			$("#btfInqrySj").val(res.btfInqrySj);
			// 문의 내용
			$("#btfInqryCn").html(res.btfInqryCn);	
			// 답글 시간
			if(res.btfInqryAnswerWrDt != null && res.btfInqryAnswerCn != null ){
				$("#btfInqryAnswerWrDt").text(res.btfInqryAnswerWrDt);
			}
			// 답글 내용
			if(res.btfInqryAnswerCn == null){
				$("#btfInqryAnswerCn").text("등록된 답글이 없습니다.");
			}else{
				$("#btfInqryAnswerCn").html(res.btfInqryAnswerCn);
			}
			
			},
		error : function(xhr){
				alert("오류 내용 : " + xhr.status);
		}
	});
}

$("cancelBtn").on("click", function(){
	
	$("#btfInqrySj").html("");
	$("#btfInqryCn").html("");
	$("#btfInqryAnswerCn").html("");
});
</script>