<%@page import="java.util.Enumeration"%>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page session="true" %>
<%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %>


<head>
	<title>Home</title>
</head>

<script>
//검색하기
$(function(){
	$("#navbar-search-icon").on("click",function(){
		let currentPage="1";
		$("#proListBody").html(""); 
		console.log("keyword : " + $("#keyword").val());
		let key = $("#keyword").val();
		let data = {
				"currentPage":currentPage,
				"keyword":key
		}
		console.log("data : ", data);
		proList(data);
		let url = "/proSearch/proList?currentPage=" + currentPage + "&keyword=" + key;
		window.location.href = url;
	});
});

//검색한 프로 찾기
function proList(data){
    $.ajax({
        type: "post",
        url: "/proSearch/searchPage",
        data: JSON.stringify(data),
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(res){
            console.log(res);
            
            let str = "";
            if(res.content == null || res.content.length == 0 || res.content == ""){
            	str += "<div style='text-align: center;'>";
            	str += "<img src='../resources/images/우는모양.png' style='width:100px; height:100px; '/>";
            	str += "<h3 style='padding:20px 0 40px 0; color:#c6c9cc;'><b>검색 결과가 없어요!</b></h3>";
            	str += "</div>";
            }else{
            $.each(res.content, function(idx, ProVO){
                console.log("ProVO[" + idx + "] : ", ProVO);
                console.log("res : " , res.content);
                str += "<div style='border: 1px solid #CED4DA; border-radius: 20px; width: 800px; margin-left: 280px; padding: 10px 0;'>";
                str += "<div id='proflClick' style='display: flex; align-items: center; margin-left: 100px;' >";
                str += "<div style='width: 500px;'>";
                str += "<div style='display: flex; align-items: center;'>";
                str += "<div style='width: 200px;'>";
                str += "<h3>"+ProVO.userSeVOList[0].userNcnm+"</h3>";
                str += "<p id='proIds'>" + ProVO.proId + "</p>"; 
                str += "</div>";
                str += "<div style='width: 300px;'>";
                str += "<p class='spcltyRealm' style='border: 1px solid #CED4DA; border-radius: 20px; display: inline-block;'>&nbsp&nbsp"+ProVO.spcltyRealmVOList[0].spcltyRealmNm+"&nbsp&nbsp</p>";
                str += "<p style='border: 1px solid #CED4DA; border-radius: 20px; display: inline-block;'>&nbsp;&nbsp;"+ProVO.proflVOList[0].proProflContactPosblTime+"&nbsp;&nbsp;</p>";
                str += "<p class='profl-info' style='border: 1px solid #CED4DA; border-radius: 20px; display: inline-block;'>";
                str += "&nbsp;&nbsp;<span class='bcityNm'>"+ProVO.vcityVOList[0].bcityNm+"</span>&nbsp;";
                str += "<span class='brtcNm'>"+ProVO.vcityVOList[0].brtcNm+"</span>&nbsp;&nbsp;";
                str += "</p>";
                str += "</div>";
                str += "</div>";
                str += "<div>";
                str += "<p>"+ProVO.proflVOList[0].proProflOnLiIntrcn+"</p>";
                str += "</div>";
                str += "</div>";
                str += "<div style='margin-left: 20px;'>";
                str += "<img class='proProflPhoto' src='"+ (ProVO.proProflPhoto == null ? '/images/2024/profile.jpg' : ProVO.proProflPhoto) +"' style='width: 100px; height: 100px; border-radius: 20%;'> ";  
                str += "</div>";
                str += "</div>";
                str += "</div>";
                str += "<br><br>";
            });
            
            }
            if(window.location.href == "http://localhost/proSearch/proList"){
    		$("#title").html('프로 찾기');             	            	
            }else{
    		$("#title").html('"'+res.keyword+'" 의 검색 결과');             	
            }
            
            $("#proListBody").html(str); 
            $("#keyword").val("");
			
            $(document).on('click', '#proflClick', function() {
                let proId =$("#proIds").text();
                console.log("proId",proId);
                let url = '/proProfl/detail?proId=' + proId;
                window.location.href = url;
            });
            
            //페이징처리
            if(res.content == null || res.content.length === 0){
            	$("#S_divPaging").html("");
            }else{            	
            	$("#S_divPaging").html(res.pagingArea);
            }
        }
    });
}

//엔터처리
    $(document).on('keydown', function(e){
        if (e.code == 'Enter') {
            // 검색 버튼 클릭
            $('#navbar-search-icon').click();
        }
    });

</script>

<div style="display: flex; flex-wrap: wrap; justify-content: center;">
<%-- 		<%
Enumeration sen = session.getAttributeNames();

while(sen.hasMoreElements()){
	String nm = (String)sen.nextElement();
	out.print("<p>개똥이 : " + session.getAttribute(nm) + "</p>");
}
%> --%>
    <div style="position: relative;">
        <img src="../resources/images/메인3.gif" style="width:120%; border-radius: 30px; margin-left:-60px;">
        <div style="position: absolute; top: 20%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
	        <div style="display: flex; flex-wrap: wrap; text-align:center;">
	            <span style="margin-left:90px;"><h5>눈에 띄는 프로를 찾아주세요!</h5></span>
	            <div class="input-group">
	                <div class="input-group-prepend hover-cursor" id="navbar-search-icon">
	                    <span class="input-group-text" id="search">
	                      <i class="icon-search text-primary"></i>
	                    </span>
	                </div>
	                <input type="text" class="form-control" id="keyword" placeholder="눈에띄는 프로찾기" style="width:40px;"aria-label="search" aria-describedby="search">
	            </div>
	        </div>
        </div>
    </div>
</div>
