<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<link rel="stylesheet" href="/resources/css/sweetalert2.min.css">
<script src="/resources/js/sweetalert2.min.js"></script>
<script type="text/javascript" src="/resources/js/jquery.min.js"></script>
<style>
.starR{
  display: inline-block;
  width: 30px;
  height: 30px;
  color: transparent;
  text-shadow: 0 0 0 #4B49AC;
  font-size: 1.8em;
  box-sizing: border-box;
  cursor: pointer;
}
.money{
  display: inline-block;
  width: 30px;
  height: 30px;
  color: transparent;
  text-shadow: 0 0 0 #F9C23C;
  font-size: 1.8em;
  box-sizing: border-box;
  cursor: pointer;
}
.innerDiv {
	height: auto;
/* 	text-align: center; */
}
.sidenav {
	width: 200px;
	position: fixed;
	z-index: 1;
	font-size: 0.5rem;
	top: 300px;
	left: 10px;
	border-bottom: 1px solid lightgray;
	overflow-x: hidden;
	padding: 8px 0;
}
.sidenav p {
	padding: 6px 8px 6px 16px;
	text-decoration: none;
	font-size: 18px;
	display: block;
}
.sidenav a {
	padding: 6px 8px 6px 16px;
	text-decoration: none;
	font-size: 18px;
	color: #4B49AC;
	display: block;
}

.sidenav a:hover {
	color: black;
}

.main {
	margin-left: 140px; /* Same width as the sidebar + left position in px */
	font-size: 10px; /* Increased text to enable scrolling */
	padding: 0px 10px;
}

@media screen and (max-height: 450px) {
	.sidenav {padding-top: 15px;}
	.sidenav a {font-size: 10px;}
}
</style>
<script>
function pagingList(data){
// 	$("#moneyRate").val(data.totalPrice);
	$.ajax({
		url : "/onedayClass/proOndyclListAjax",
		type : "post",
		data : JSON.stringify(data),
		contentType: "application/json;charset=utf-8",
		dataType:"json",
		success : function(res){
			if(res.total == 0){
				alert("ê²€ìƒ‰ ê²°ê³¼ê°€ í•˜ë‚˜ë„ ì—†ìŠµë‹ˆë‹¤.");
			}
			console.log("res:",res);
			let date = new Date();
			let today = date.getFullYear().toString() +"."+ String(date.getMonth() + 1).padStart(2,"0") +"."+ String(date.getDate()).padStart(2,"0");
			let threeDay = new Date(date.setDate(date.getDate() + 3));
			let thirdDate = date.getFullYear().toString() +"."+ String(date.getMonth() + 1).padStart(2,"0") +"."+ String(date.getDate()).padStart(2,"0");
			let str = "";
// 			console.log(today +"/"+thirdDate);
			$("#myClassTbody").html("");
			
			$.each(res.content,function(idx, vOndyclProUsersVO){
				str += "<tr style=\"cursor: pointer;\">";   
				/* str += "<tr>"; */
				if(vOndyclProUsersVO.ondyclDelType == 0){
		
					
					if(today < vOndyclProUsersVO.ondyclSchdulDe){
						str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=proMyClass'\">"+vOndyclProUsersVO.rnum+"</td>";
						str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=proMyClass'\">"+vOndyclProUsersVO.ondyclNm+"</td>";
						str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=proMyClass'\">"+vOndyclProUsersVO.ondyclSchdulDe+"</td>";
						if(thirdDate < vOndyclProUsersVO.ondyclSchdulDe){
							str += "<td><button type='button' class='btn btn-outline-secondary btn-rounded btn-icon' id='"+vOndyclProUsersVO.ondyclNo+"' onclick='proCancelClass(this)'><i class='mdi mdi-heart-broken'></i></button></td>";
						}else{
							str += "<td><button type='button' disabled class='btn btn-outline-secondary btn-rounded btn-icon' id='"+vOndyclProUsersVO.ondyclNo+"' onclick='proCancelClass(this)'><i class='mdi mdi-heart-broken'></i></button></td>";
						}
					}else{
						str += "<td style='color:lightgray;' onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=proMyClass'\">"+vOndyclProUsersVO.rnum+"</td>";
						str += "<td style='color:lightgray;' onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=proMyClass'\">"+vOndyclProUsersVO.ondyclNm+"</td>";
						str += "<td style='text-decoration:line-through; color:red;' onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=proMyClass'\">"+vOndyclProUsersVO.ondyclSchdulDe+"</td>";
						str += "<td><button type='button' disabled class='btn btn-outline-secondary btn-rounded btn-icon' id='"+vOndyclProUsersVO.ondyclNo+"' onclick='proCancelClass(this)'><i class='mdi mdi-heart-broken'></i></button></td>";
					}
					str += "</tr>";
				}else{
					str += "<td style='text-decoration:line-through; color:gray;'>"+vOndyclProUsersVO.rnum+"</td>";
					str += "<td style='text-decoration:line-through; color:gray;'>"+vOndyclProUsersVO.ondyclNm+"</td>";
					str += "<td style='text-decoration:line-through; color:gray;'>"+vOndyclProUsersVO.ondyclSchdulDe+"</td>";
	// 				console.log(today);
	// 				console.log(vOndyclProUsersVO.ondyclSchdulDe);
					str += "<td><button type='button' disabled class='btn btn-outline-secondary btn-rounded btn-icon' id='"+vOndyclProUsersVO.ondyclNo+"' onclick='proCancelClass(this)'><i class='mdi mdi-heart-broken'></i></button></td>";
					str += "</tr>";
					
				}
			
			});
			$("#myClassTbody").append(str);
			$("#keyword").val("");
// 			console.log("ì—¬ê¸°ìš” : ",res.pagingArea);
			$("#divPagingArea").html(res.pagingArea);
// 			sessionStorage.setItem("total",res.total);
		}
	});
}

function proCancelClass(e){
// 	console.log(e.id);
	Swal.fire({
		content: "input",
		title: "ì›ë°ì´ í´ë˜ìŠ¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?",
		text: "ì‚­ì œë¥¼ ì§„í–‰í•˜ë ¤ë©´ ì•„ë˜ 'ì‚­ì œì§„í–‰' ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.",
		input: 'text',
		icon: 'warning',
		showCancelButton: true,
		confirmButtonColor: '#3085d6',
		cancelButtonColor: '#d33',
		confirmButtonText: 'í™•ì¸',
		cancelButtonText: 'ì·¨ì†Œ'
		// dangerMode: true
	}).then((result) => {
		if (result.value == "ì‚­ì œì§„í–‰") { //ì‚­ì œ ì§„í–‰ ê°€ëŠ¥
			$.ajax({
				url: "/onedayClass/deleteClass?classNo=" + e.id,
				type: "get",
				success: function (res) {
					Swal.fire({
						title: 'ì›ë°ì´í´ë˜ìŠ¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.',
						icon: 'success',
						showCancelButton: false,
						confirmButtonColor: '#3085d6',
						confirmButtonText: 'í™•ì¸'
					}).then((result) => {
						if (result.isConfirmed) {
							window.history.back();
						}
					});
				}
			})
		} else if (result.isDismissed) {
			Swal.fire("ì›ë°ì´í´ë˜ìŠ¤ ì‚­ì œ ì·¨ì†Œ");
		} else { //ì¸ì¦ë²ˆí˜¸ í‹€ë¦¬ë©´
			Swal.fire({
				title: 'ì…ë ¥í…ìŠ¤íŠ¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
				text: 'ì…ë ¥í…ìŠ¤íŠ¸ê°€ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ì‚­ì œë¥¼ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.',
				icon: 'error',
				showCancelButton: false,
				confirmButtonColor: '#3085d6',
				confirmButtonText: 'í™•ì¸'
			})
		}
	});
}

$(document).ready(function(){
	//ê²€ìƒ‰ì¡°ê±´ ì œëª©
	$("#title").on("click",function(){
		const btnElement = document.getElementById('searchCategory');
		btnElement.innerText = 'ì œëª©';
		$('#keyword').attr("type", "text");
		$("#searchKeyword").val("title");
		$("#keyword").val("");
	})
	//ê²€ìƒ‰ì¡°ê±´ ë‚ ì§œ
	$("#date").on("click",function(){
		const btnElement = document.getElementById('searchCategory');
		btnElement.innerText = 'ë‚ ì§œ';
		$('#keyword').attr("type", "date");
		$("#searchKeyword").val("date");
		$("#keyword").val("");
	})
	
	let searchKeyword = $("#searchKeyword").val();
	let userId = $("#sessionId").val();
	if($("#sessionId").val() == ""){
		alert("ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.");
		location.href="/main";
	}
	
	$("#btnSearch").on("click",function(){
		let keyword = $("#keyword").val();
		let currentPage = "1";
		let searchKeyword = $("#searchKeyword").val();
		
		console.log(keyword + "/" + searchKeyword);
		let data = {
			"keyword":keyword,
			"currentPage":currentPage,
			"proId":userId,
			"searchKeyword":searchKeyword
		};
// 		console.log("data1:",data)
		pagingList(data);
	});
	let currentPage = "${param.currentPage}"
	if(currentPage == ""){
		currentPage = "1";
	}
	let data = {
		"keyword":"${param.keyword}",
		"currentPage":currentPage,
		"proId":userId,
		"searchKeyword":searchKeyword
	};
// 	console.log("data2: ",data);
	pagingList(data);
	
})

</script>
<div class="container col-lg-10">
	<input type="hidden" id="sessionId" value="${proSession.userId}" />
	<div class="col-12 stretch-card grid-margin grid-margin-md-0">
		<div class="card data-icon-card-primary">
			<div class="card-body">
				<p class="card-title text-white"></p>
				<div class="row">
					<div class="col-8 text-white">
						<h3>ì›ë°ì´í´ë˜ìŠ¤ ê´€ë¦¬ì…ë‹ˆë‹¤.</h3>
						<p class="text-white font-weight-500 mb-0">This is a Onedayclass list you reserved before.</p>
					</div>
					<div class="col-4 background-icon"></div>
	
				</div>
			</div>
		</div>
	</div>
	
	<div class="sidenav">
		<p style="text-align:center;"><b>ë§ˆì´í˜ì´ì§€ ë©”ë‰´</b></p><hr>
		<a href="/pro/proMypage">ë§ˆì´í˜ì´ì§€</a>
		<a href="/srvcBtfInqry/btfInqryList">ë°›ì€ ì„œë¹„ìŠ¤ ë¬¸ì˜ ë‚´ì—­</a>
		<a href="/srvcReust/srvcRqList">ë°›ì€ ì„œë¹„ìŠ¤ ìš”ì²­ ë‚´ì—­</a>
		<a href="/onedayClass/proMyClassList">ì›ë°ì´í´ë˜ìŠ¤</a>
		<a href="/pro/proPostList">ê²Œì‹œê¸€ ê´€ë¦¬</a>
		<a href="#">ë¦¬ë·° ê´€ë¦¬</a>
		<a href="#">1:1 ë¬¸ì˜ ë‚´ì—­</a>
	</div>
	<div class="col-12 grid-margin stretch-card" style="margin-top:20px; margin-bottom:5px;">
		<div class="col-md-6" style="margin-top: 10px;">
			<h3>${proSession.userNcnm} ë‹˜ì˜ ì›ë°ì´í´ë˜ìŠ¤ í†µê³„ì…ë‹ˆë‹¤.</h3>
		</div>
	</div>
	<div class="col-12 grid-margin stretch-card" style="margin-top:5px;">
		<div class="innerDiv col-6">
			<div class="card">
				<div class="card-body">
					<h4 class="card-title">ì›”ë³„ ì´ìš©ì/ê¸ˆì•¡ í†µê³„</h4>
					
				</div>
			</div>
		</div>
		<div class="innerDiv col-6">
			<div class="grid">
				<div class="g-col-6">
					<div class="card-body">
						<h4 class="card-title">ì „ì²´ ë³„ì  í†µê³„</h4>
						<div class="row">
							<div class="starRev" style="margin-right:15px;">
								<span class="starRev starR on">â­</span>
							</div>
							<p style="font-size:1.7rem; line-height: 40px;" id="starRate">asdasd</p>
						</div>
					</div>
				</div>
				<div class="g-col-6">
					<div class="card-body">
						<h4 class="card-title">í†µí•© ë§¤ì¶œ</h4>
						<div class="row">
							<div class="starRev" style="margin-right:15px;">
								<span class="starRev money">ğŸ’²</span>
							</div>
							<p style="font-size:1.7rem; line-height: 40px;" id="moneyRate">${totalPrice} ì›</p>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="col-12 grid-margin stretch-card">
	<input type="hidden" id="searchKeyword" value="title">
		<div class="card">
			<div class="card-body">
				<div class="row">
					<div class="col-md-6" style="margin-top: 10px;">
						<h3>ì›ë°ì´í´ë˜ìŠ¤ ìƒì„±ë‚´ì—­</h3>
						<p class="font-weight-500 mb-0" style="color: red">â€»í´ë˜ìŠ¤ ì‹œì‘ 3ì¼ì „ë¶€í„°ëŠ” í´ë˜ìŠ¤ë¥¼ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
					</div>
					<div class="col-md-6 form-group text-center"> <!-- ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•´ text-center í´ë˜ìŠ¤ ì¶”ê°€ -->
						<div class="input-group">
							<button class="btn btn-inverse-primary btn-fw btnSelect dropdown-toggle"
								type="button" id="searchCategory" data-toggle="dropdown" aria-haspopup="true"
								aria-expanded="false">ì œëª©</button>
							<div class="dropdown-menu" style="">
								<a class="dropdown-item" href="#" id="title">ì œëª©</a>
								<a class="dropdown-item" href="#" id="date">ë‚ ì§œ</a>
							</div>
							<input type="text" name="keyword" id="keyword" value="${param.keyword}" class="form-control" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" aria-label="">
							<div class="input-group-append">
								<button class="btn btn-sm btn-primary" id="btnSearch" type="button">
								Search <i class="fas fa-se	arch"></i>
								</button>
							</div>
						</div>
					</div>
				</div>
				<div class="table-responsive">
					<table class="table table-hover">
						<thead>
							<tr class="text-white" style="background-color: #4b49ac">
								<th style="width: 10%;">ê¸€ë²ˆí˜¸</th>
								<th style="width: 50%;">ì œëª©</th>
								<th style="width: 10%;">ì§„í–‰ì¼ì</th>
								<th style="width: 10%;">í´ë˜ìŠ¤ì·¨ì†Œ</th>
							</tr>
						</thead>
						<tbody id="myClassTbody">
							<!-- ê³µì§€ì‚¬í•­ ë‚´ìš©ì´ í‘œì‹œë˜ëŠ” ë¶€ë¶„ -->
						</tbody>
					</table>
				</div>
				<div class="row justify-content-center" style="margin-top: 20px;">
					<div id="divPagingArea"></div>
				</div>
			</div>
		</div>
	</div>
</div>