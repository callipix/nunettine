<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>
<!DOCTYPE html>
<html>
<head>
<title>공지상세보기</title>
</head>
<script  type="text/javascript" src="/resources/js/jquery.min.js"></script>
<script type="text/javascript">
$(function(){
    console.log("정상실행");
    
    $("#list").on("click",function(){
        location.href="/admin/notice";
    });
    
    $("#delete").on("click",function(){
    	console.log("정상실행3")
    	//id속성의 값이 noticeNo인 요소의 벨류값
    	//let noticeNo = $("#noticeNo").val();
   		//요청 파라미터의 noticeNo이름의 벨류값
    	let noticeNo = "${param.noticeNo}";
    	let data = {
    		"noticeNo":noticeNo
    	};
    	console.log("data", data);
    	
    	$.ajax({
    		url:"/admin/delete",
    		contentType:"application/json;charset=utf-8",
    		data:JSON.stringify(data),
    		type:"post",
    		dataType:"text",
    		success:function(result){
    			console.log("result:",result);
    			alert("삭제완료");
    			location.href="/admin/notice";
    		}
    	});
    	
    	
    	
    });
    
    $('#edit').on("click",function(){
        console.log("정상실행2")
        $("#p1").hide();

        // 공지사항 내용을 수정할 수 있는 입력 필드로 변경
        let noticeCnEdit = $("#noticeCn");

        noticeCnEdit.attr("contenteditable", "true"); // 수정 가능하도록 설정
        noticeCnEdit.focus(); // 입력 필드에 포커스를 줌
		
        
        // 수정 완료 후 확인 버튼 활성화
        $("#p2").show();
    });
   
    $('#cancel').on("click",function(){
    	alert("취소")
    	$("#p1").show();
    	$("#p2").hide();
    });
    

    $('#confirm').on("click",function(){
        console.log("수정 내용 확인");

        let noticeNo = "${param.noticeNo}";
        let noticeCnNew = $("#noticeCn").text();
        // 수정이 완료된 내용을 가져옴
        
	
        
        // 수정된 내용을 전송
        $.ajax({
            url:"/admin/update",
            contentType:"application/json;charset=utf-8",
            data: JSON.stringify({ "noticeCn": noticeCnNew,"noticeNo":noticeNo}),
            type:"post",
            dataType:"text",
            success:function(result){
                console.log("result: " + result);
                
                
              
                // 수정 완료 후 다시 읽기 전용으로 변경
                let noticeCnEdit = $("#noticeCn");
                noticeCnEdit.attr("contenteditable", "false"); // 수정 불가능하도록 설정
           
                // 확인 버튼을 다시 감춤
                $("#p2").hide();
                $("#p1").show();
                	                		
                }
                
                
          
        });
        
    });
    
});
</script>
<body>

<div class="col-md-12 grid-margin stretch-card">
    <div class="card">
        <div class="card-body">
            <h4 class="card-title">공지상세</h4>
				<div>
                <h3>${noticeVO.noticeSj}</h3>
                <!-- 수정 가능한 내용으로 변경 -->
                <p id="noticeCn" contenteditable="false"><b>${noticeVO.noticeCn}</b></p>
                <p><b>${noticeVO.noticeWritngDt}</b></p>
                <p><b>${noticeVO.mngrId}</b></p>
                <p><b>${noticeVO.noticeRdcnt}</b></p>
                <p><b>${noticeVO.sprviseAtchmnflNo}</b></p>
				</div>
        </div>
    </div>
</div>

<div>
    <p id="p1">
        <button type="button" id="edit" class="btn btn-primary">수정</button>
        <button type="button" id="delete" class="btn btn-primary">삭제</button>
        <button type="button" id="list" class="btn btn-primary">목록</button>
    </p>
    
    <p id="p2" style="display:none;">
        <button type="button" id="confirm" class="btn btn-primary">확인</button>
        <button type="button" id="cancel" class="btn btn-primary">취소</button>
    </p>
</div>

</body>
</html>