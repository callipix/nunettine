package kr.or.ddit.pro_service.service_inquiry.controller;




import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;

import kr.or.ddit.pro_service.service_inquiry.service.SrvcBtfInqryService;
import kr.or.ddit.pro_service.service_inquiry.vo.V_SrvcBtfInqryVO;
import kr.or.ddit.vo.UsersVO;
import lombok.extern.slf4j.Slf4j;
@Slf4j
@Controller
@RequestMapping("/srvcBtfInqry")
public class SrvcBtfInqryController {
	
	@Autowired
	SrvcBtfInqryService srvcBtfInqryService;
	
	// 세션에서 가져올 아이디
	String userId= "";
	V_SrvcBtfInqryVO vSrvcBtfInqryVO = new V_SrvcBtfInqryVO();

	@GetMapping("/btfInqryList")
	public String btfInqryList(Model model) {
		
		// session에서 꺼내올 아이디
		userId = "testPro";

		// 아이디 유형 검사
		// 회원일 경우 : usersVO.getEmplyrTy() = ET01 -> SrvcBtfInqryVO의 userId와 emplyrTy저장
		UsersVO usersVO = this.srvcBtfInqryService.userChk(userId);
		vSrvcBtfInqryVO.setUserId(usersVO.getUserId());
		vSrvcBtfInqryVO.setEmplyrTy(usersVO.getEmplyrTy());
		log.info("btfInqryList -> usersVO 확인 : " + usersVO );
		
		List<V_SrvcBtfInqryVO> vSrvcBtfInqryVOList = 
				this.srvcBtfInqryService.btfInqryList(vSrvcBtfInqryVO);
		
		model.addAttribute("vSrvcBtfInqryVOList", vSrvcBtfInqryVOList);
		log.info("btfInqryList -> vsrvcBtfInqryVOList : " + vSrvcBtfInqryVOList );
		
		return "srvcBtfInqry/btfInqryList";
	}
	
	@GetMapping("/btfInqryDetail")
	@ResponseBody
	public V_SrvcBtfInqryVO btfInqryDetail(@RequestParam int btfInqryNo){
		
		log.info("btfInqryDetail -> btfInqryNo : " + btfInqryNo);
		
		// 가져온 번호 저장
		vSrvcBtfInqryVO.setBtfInqryNo(btfInqryNo);
		log.info("btfInqryDetail -> vSrvcBtfInqryVO : " + vSrvcBtfInqryVO);
		
		// 아이디 유형 검사
		UsersVO usersVO = this.srvcBtfInqryService.userChk(userId);
		vSrvcBtfInqryVO.setUserId(usersVO.getUserId());
		vSrvcBtfInqryVO.setEmplyrTy(usersVO.getEmplyrTy());
		
		 vSrvcBtfInqryVO = this.srvcBtfInqryService.btfInqryDetail(vSrvcBtfInqryVO);
		log.info("btfInqryDetail -> vSrvcBtfInqryVO.getSprviseAtchmnflVOList() : " + vSrvcBtfInqryVO.getSprviseAtchmnflVOList());
		
		return vSrvcBtfInqryVO;
		
	}
	

	
}
