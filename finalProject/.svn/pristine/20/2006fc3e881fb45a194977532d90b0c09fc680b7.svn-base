<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%-- <%@ taglib prefix="sec" uri="http://www.springframework.org/security/tags"%> --%>  
<script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js"></script>
<script type="text/javascript" src="/resources/js/jquery.min.js"></script>
<script type="text/javascript" src="/resources/js/bootstrap.bundle.js"></script>
<script src="https://cdn.ckeditor.com/ckeditor5/41.2.0/classic/ckeditor.js"></script>

<link type="text/css" rel="stylesheet" 
	href="/resources/ckeditor5/sample/css/sample.css" media="screen" />
<script type="text/javascript">
$(function(){
	
	$("#uploadFile").on("change", function() {
        $("#imgDiv").css("display", "none");
     });$("#uploadFile").on("change", function() {
         $("#imgDiv").css("display", "none");
     });
     
	$("#uploadFile").on("change",handleImgFileSelect);
	function handleImgFileSelect(e){
		//이벤트가 발생 된 타겟 안에 들어있는 이미지 파일들을 가져와보자
		let files = e.target.files;
		

		console.log(files);
		let fileArr = Array.prototype.slice.call(files);
	
		fileArr.forEach(function(f){
			//이미지 파일이 아닌 경우 이미지 미리보기 실패 처리(MIME타입)
			
			console.log(f);
			if(!f.type.match("image.*")){
				alert("이미지 파일만 가능합니다.");
				//함수 종료
				return;
			}
			//이미지 객체를 전역 배열타입 변수에 넣자
			//이미지 객체를 읽을 자바스크립트의 reader 객체 생성
			let reader = new FileReader();
			
			$(".clsCiImgUrl").html("");
			
			//e : reader가 이미지 객체를 읽는 이벤트
			reader.onload = function(e){
				$(".clsCiImgUrl").css({
			          "background-image": "url(" + e.target.result + ")",
			          "background-position": "center",
			          "background-size": "cover",
			          "width": "300px", 
			          "height": "200px",
			          "border": "1px solid #ccc"
			        });
// 				
			}
			//f : 이미지 파일 객체를 읽은 후 다음 이미지 파일(f)을 위해 초기화 함
			reader.readAsDataURL(f);
		});//end forEach
	}
	
	var fileNo = 0;
	var filesArr = new Array();
	
	/* 첨부파일 추가  이미지 미리보기 시작*/
	let sel_file = [];
	$("#uploadFile").on("change",handleImgFileSelect);
	function handleImgFileSelect(e){
		let files = e.target.files;
		console.log("files : "+ files);
		
		let fileArr = Array.prototype.slice.call(files);
		console.log("fileArr : %o"+ fileArr);
		
		fileArr.forEach(function(str){
			console.log("str : " + str);
		});
		
	}
		
	
	console.log("개똥이");
	
	$(".ck-blurred").keydown(function(){
		console.log("str : " + window.editor.getData());
		
		$("#lbrtyBbscttCn").val(window.editor.getData());
	});
	
	$(".ck-blurred").on("focusout",function(){
		$("#lbrtyBbscttCn").val(window.editor.getData());
	});
	
});
</script>

<style> 
     .ck-editor__editable_inline{ 
     min-height:550px; 
     } 
</style>
<div class="card card-primary">
	<div class="card-header">
		<h3 class="card-title">게시글 작성</h3>
	</div>

	<!-- 
	요청URI : /stud/create?register
	요청파라미터 : {studId=a001,studNm=개똥이,studPw=java,studDet=학생상세내용
				,gender=여성,nationality=korea,postNum=12345,studAddress=대전 중구
				,studAddress2=123-33}
	파람즈 : register
	요청방식 : post
	 -->
	<form name="frm" id="frm" action="/lbrtybbsctt/create" 
	method="post" enctype="multipart/form-data" >
		<div class="card-body">
			<div class="form-group">
				<label for="userId">작성자 아이디</label> 
				<input type="text" name="userId" class="form-control" id="userId"
					placeholder="작성자 아이디" required />
			</div>
			<div class="form-group">
				<label for="lbrtyBbscttSj">게시글 제목</label> 
				<input type="text" name="lbrtyBbscttSj" class="form-control" id="lbrtyBbscttSj"
					placeholder="게시글 제목" required />
			</div>
			<div class="form-group">
					<label for="uploadFile">첨부 파일</label>
					<div class="custom-file">
						<input type="file" name="uploadFile" id="uploadFile"
							 class="custom-file-input filebox" 
							 multiple />
							 <div class="file-list"></div>
						<label class="custom-file-label" for="uploadFile">Choose file</label>
					</div> 
				</div>
			<!--  -->
			<div id="imgUpDiv" class="form-group" style="display;">
                <label>이미지 파일</label>
                <input type="file" id="uploadFile" name="uploadFile" class="file-upload-default" 
                multiple />
                <div class="input-group col-xs-12">
                    <input type="text" class="form-control file-upload-info" placeholder="파일선택">
                    <span class="input-group-append">
                        <button class="file-upload-browse btn btn-primary" type="button">업로드</button>
                    </span>
                </div>
            </div>
			<!--  -->
			
			<div class="form-group">
				<label for="lbrtyBbscttCn">게시글 내용</label> 
				<div id="cklbrtyBbscttCn"
				style="height:150px;"></div>
				<textarea name="lbrtyBbscttCn" id="lbrtyBbscttCn" class="form-control" 
				rows="4" style="display:none;" ></textarea>
			</div>
		</div>

		<div class="card-footer">
			<button type="submit" class="btn btn-primary">등록</button>
			<button type="reset" class="btn btn-secondary">초기화</button>
		</div>
		<%-- <sec:csrfInput/> --%>
	</form>
</div>
<script type="text/javascript">
ClassicEditor
 .create(document.querySelector('#cklbrtyBbscttCn'),
		{ckfinder:{uploadUrl:'/upload/uploads?${_csrf.parameterName}=${_csrf.token}'}})
 .then(editor=>{window.editor=editor;})
 .catch(err=>{console.error(err.stack);});
</script>