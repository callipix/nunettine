<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<script type="text/javascript" src="/resources/js/jquery.min.js"></script>
<script src="https://cdn.ckeditor.com/ckeditor5/41.2.0/classic/ckeditor.js"></script>
<script type="text/javascript" src="/resources/ckeditor5/build/ckeditor.js"></script>

<style> 
     .ck-editor__editable_inline{ 
     min-height:500px; 
     } 
</style>
<script type="text/javascript">
$(function(){
	
	//ckEditor 내용 입력
	$(".ck-blurred").keydown(function(){
		console.log("str : " + window.editor.getData());
		$("#aftusBbscttCn").val(window.editor.getData());
	});
	
	$(".ck-blurred").on("focusout",function(){
		console.log("str : " + window.editor.getData());
		$("#aftusBbscttCn").val(window.editor.getData());
		
	});
	
	
	

	$("#uploadFile").on("change", function() {
		console.log($("#uploadFile").val());
		console.log($("image").val());
	});
	
	
	
/* 	//이미지 미리보기 시작////////////////
	let sel_file = [];
	$("#uploadFile").on("change",handleImgFileSelect);
	//e : onchange 이벤트 객체
	function handleImgFileSelect(e){
		let files = e.target.files;
		let fileArr = Array.prototype.slice.call(files);
		
		//파일 타입의 배열 반복. f : 배열 안에 들어있는 각각의 파일 객체
		fileArr.forEach(function(f){
			
			//이미지 객체를 전역 배열타입 변수에 넣음
			sel_file.push(f);
			//이미지 객체를 읽을 자바스크립트의 reader 객체 생성
			let reader = new FileReader();
			
			$(".clsCiImgUrl").html("");
			
			//e : reader가 이미지 객체를 읽는 이벤트
			reader.onload = function(e){

				$(".clsCiImgUrl").css({
			          "background-image": "url(" + e.target.result + ")",
			          "background-position": "center",
			          "background-size": "cover",
			          "width": "500px", 
			          "height": "500px",
			   
			    });
			}
			//f : 이미지 파일 객체를 읽은 후 다음 이미지 파일(f)을 위해 초기화 함
			reader.readAsDataURL(f);
		});
	}
	//이미지 미리보기 끝//////////////// */
	
	
	//파일 업로드
	$("#rvCreate").on("click", function() {
		let srvcRequstNo = $("#srvcRequstNo").val();
		let aftusBbscttSj = $("#aftusBbscttSj").val();
		let aftusBbscttCn = $("#aftusBbscttCn").val();
		let uploadFile = $("#uploadFile");//파일객체
		
		//파일 객체 안에 있는 이미지 파일들 꺼내기
		let files = uploadFile[0].files;
		
		//가상 폼<form></form>
		let formData = new FormData();
		formData.append("srvcRequstNo", srvcRequstNo);
		formData.append("aftusBbscttSj", aftusBbscttSj);
		formData.append("aftusBbscttCn", aftusBbscttCn);

		//가상폼인 formData에 각각의 이미지를 넣자
		for(let i=0; i<files.length; i++){
			formData.append("uploadFile", files[i])
		}
		
	
		$.ajax({
			url:"/reviewBoard/createAjax",
			processData:false,
			contentType:false,
			data:formData,
			dataType:"text",
			type:"post",
			success:function(aftusBbscttNo){
				console.log("result : ", aftusBbscttNo);
				location.href="/reviewBoard/detail?aftusBbscttNo=" + aftusBbscttNo;
			}
		});
	})
});
</script>
<h2>후기</h2>
<div class="card">
  <div class="card-body">
    <h4 class="card-title"></h4>
    <p class="card-description">
	<p>${srvcRequstNo}</p>
	
    <form action="" class="forms-sample" method="post" enctype="multipart/form-data">
    	
    	<input type="hidden" class="form-control" id="srvcRequstNo" name="srvcRequstNo" value="${srvcRequstNo}" required>
    
		
      <div class="form-group">
        <label for="aftusBbscttSj">제목</label>
        <input type="text" class="form-control" id="aftusBbscttSj" name="aftusBbscttSj" required>
      </div>
    
      
      
<!--      <div class="form-group">
        <label for="aftusBbscttCn">내용</label>
        <textarea class="form-control" rows="10" id="aftusBbscttCn" name="aftusBbscttCn"></textarea>
      </div> -->
      


      <div class="form-group">
        <label for="aftusBbscttCn">내용</label>
        <div id="ckEditor" class="ckEditor"></div>
        <textarea class="form-control" rows="10" id="aftusBbscttCn" name="aftusBbscttCn" style="display: none;"></textarea>
      </div>
      
      

<!--        <div class="clsCiImgUrl  col-xs-12"> -->

<!--       </div> -->
      <div class="form-group">
        <label>이미지 파일</label>
        <input type="file" id="uploadFile" name="uploadFile" class="file-upload-default" multiple>
        <div class="input-group col-xs-12">
          <input type="text" id="image" class="form-control file-upload-info" disabled="" placeholder="파일선택">
          <span class="input-group-append">
            <button class="file-upload-browse btn btn-primary" type="button">업로드</button>
          </span>
        </div>
      </div>

      <button type="button" id="rvCreate" class="btn btn-primary mr-2">등록</button>
      <button class="btn btn-light">취소</button>
    </form>
  </div>
</div>


<script type="text/javascript">
ClassicEditor
 .create(document.querySelector('#ckEditor'),
		{ckfinder:{uploadUrl:'/upload/uploads'}})
 .then(editor=>{window.editor=editor;})
 .catch(err=>{console.error(err.stack);});
</script>
