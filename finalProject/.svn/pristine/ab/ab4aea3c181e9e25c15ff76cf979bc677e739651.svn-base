<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<script src="/resources/js/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<div class="col-12">
	<div class="card">
		<div class="card-body">
			<h3 class="card-title">${vSrvcBtfInqryVO.btfInqrySj}</h3>
			<p class="card-description"><fmt:formatDate pattern="yyyy.MM.dd HH:mm" value="${vSrvcBtfInqryVO.btfInqryWrDt}"/></p>
			<hr />
			<div class="row">
				<div class="col-md-10 mx-auto">
					<div class="tab-content tab-content-custom-pill" id="pills-tabContent-custom">
						<form id="btfInqryDetailFrm" action="/srvcBtfInqry/acceptbtfInqry" method="post" >
							<!-- 요청서 본문 -->
							<input type="hidden" id="srvcRequstNo" name="srvcRequstNo" value="${vSrvcBtfInqryVO.btfInqryNo}" />
							<div>
								<!-- 요청서 이미지 -->
								<div class="d-flex mb-4" id="btfIqnryImages">
									<c:forEach var="sprviseAtchmnflVO" items="${vSrvcBtfInqryVO.sprviseAtchmnflVOList}" varStatus="status">
										<img alt="sample image" src="${sprviseAtchmnflVO.atchmnflCours}"
											 style="width: 150px; height: 130px; border-radius: 20%; margin-right: 10px;">
									</c:forEach>
<%-- 									<img class="w-25 h-100 rounded" src="${portfolio.atchmnflCours}" style="width:150px; height:130px; border-radius: 20%"> --%>
								</div>
								<p id="srvcRequstCn">${vSrvcBtfInqryVO.btfInqryCn}</p>
							</div>
						</form>
						<!-- 답글 -->
						<c:choose>
							<c:when test="${vSrvcBtfInqryVO.btfInqryAnswerCn != null}">
								<hr /> 
								<div class="mb-3 btfInqryAnswerCn">
					            	<label for="btfInqryAnswerCn" class="col-form-label">문의 답글</label>
					            	<p class="card-description"><fmt:formatDate pattern="yyyy.MM.dd HH:mm" value="${vSrvcBtfInqryVO.btfInqryAnswerWrDt}"/></p>
				    	        	<div class="form-control" id="btfInqryAnswerCn">${vSrvcBtfInqryVO.btfInqryAnswerCn}</div>         	
								</div>
							</c:when>
							<c:when test="${vSrvcBtfInqryVO.btfInqryAnswerCn == null && vSrvcBtfInqryVO.emplyrTy == 'ET01'}">
								<hr /> 
								<div class="mb-3 btfInqryAnswerCn">
					            	<label for="btfInqryAnswerCn" class="col-form-label">문의 답글</label>
				    	        	<div class="form-control" id="btfInqryAnswerCn">등록된 답글이 없습니다.</div>         	
								</div>
							</c:when>
							<c:when test="${vSrvcBtfInqryVO.btfInqryAnswerCn == null && vSrvcBtfInqryVO.emplyrTy == 'ET02'}">
								<hr /> 
								<div class="mb-3 btfInqryAnswerCn">
					            	<label for="btfInqryAnswerCn" class="col-form-label">문의 답글</label>
				    	        	<div class="form-control" id="btfInqryAnswerCn">답글을 등록해라</div>         	
								</div>
							</c:when>
						</c:choose>
					</div>
				</div>
			</div>
         	<hr />
        	<!-- 버튼 -->
         	<div>
				<button type="button" class="btn btn-inverse-secondary clsBtn">닫기</button>
				<button type="button" class="btn btn-inverse-primary" id="answerChkBtn" onclick="answerChkBtn('${vSrvcBtfInqryVO.btfInqryNo}')" style="display: none;">등록</button>
			</div>
		</div>
	</div>
</div>
<!-- 수락 모달 -->
<div class="modal fade" id="answerChkModal" tabindex="-1" 
	aria-labelledby="exampleModalLabel-2" aria-hidden="true">
	<div class="modal-dialog modal-sm" role="document">
		<div class="modal-content"">
			<div class="modal-body">
				<img alt="small image" src="/resources/images/alert_warning.png" style="width:100px;">
				<h2>답글을 등록하시겠습니까?</h2>
				<h4>답글 등록 시, 변경할 수 없습니다.</h4>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-success" onclick="javascript:btfInqryAnswerBtn('${vSrvcBtfInqryVO.btfInqryNo}')">확인</button>
				<button type="button" class="btn btn-light" data-dismiss="modal">닫기</button>
			</div>
		</div>
	</div>
</div>
<script>
$(document).ready(function(){
	if(${vSrvcBtfInqryVO.emplyrTy=="ET02"} && ${vSrvcBtfInqryVO.btfInqryAnswerCn == null} ){
		console.log("프로다!");
		$("#answerChkBtn").css("display","block");
		$("#btfInqryAnswerCn").attr("contenteditable", true);
	}
});

$(".clsBtn").on("click",function(){
	window.location.href="/srvcBtfInqry/btfInqryList";
});

// $("#answerChkBtn").on("click", function(){
	
// 	console.log("확인")
// 	$('#answerChkModal').modal('show');
// 	Swal.fire({
//         title: "답글을 등록하시겠습니까?",
//         text: "등록 완료 후 변경은 불가합니다.",
//         icon: "warning",
//         showCancelButton: true,
//         confirmButtonColor: "#3085d6",
//         cancelButtonColor: "#d33",
//         confirmButtonText: "등록 완료"
//     }).then((result) => {
//         if (result.isConfirmed) {
//             Swal.fire({
//                 title: "등록 완료!",
//                 icon: "success"
//             }).then(() => {
//                 $("#srvcRqDetailFrm").submit();
//             });
//         }
//     });
// });

function answerChkBtn(no){
// 	$('#answerChkModal').modal('show');
	Swal.fire({
        title: "답글을 등록하시겠습니까?",
        text: "등록 완료 후 변경은 불가합니다.",
        icon: "question",
        showCancelButton: true,
        confirmButtonText: "등록 완료"
    }).then((result) => {
        if (result.isConfirmed) {
            Swal.fire({
                title: "등록 완료!",
                icon: "success"
            }).then(() => {
                btfInqryAnswerBtn(no);
            });
        }
    });
	$(".swal2-question").css("margin-top", "20px");
	$(".swal2-question").css("margin-bottom", "10px");
	$(".swal2-succss").css("margin-bottom", "10px");
}


function btfInqryAnswerBtn(no){
	console.log("답글 확인 번호 : ", no);
	var btfIqnryAnswerCn =	$("#btfInqryAnswerCn").html();
	var param = {
			"btfInqryAnswerCn" : btfIqnryAnswerCn,
			"btfInqryNo" : no
			}

	console.log("보낼 데이터들", param);
	$.ajax({
		url:"/srvcBtfInqry/updateAnswer",
		contentType : "application/json;charset=utf-8",
		type : "post",
		data : JSON.stringify(param),
		dataType : "json",
		success : function(res){
			console.log("답글 업데이트 결과", res);
			if(res == 1){
// 				// 입력한 내용을 input에서 div로 바꾸기
				window.location.reload();
			}
		}
	});
}
</script>

