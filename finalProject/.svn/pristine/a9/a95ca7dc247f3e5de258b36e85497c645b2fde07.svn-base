<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt"%>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<style>
@font-face {
    font-family: 'TTHakgyoansimKossuyeomR';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2402_keris@1.0/TTHakgyoansimKossuyeomR.woff2') format('woff2');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'seolleimcool-SemiBold';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2312-1@1.1/seolleimcool-SemiBold.woff2') format('woff2');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'GmarketSansMedium';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2001@1.1/GmarketSansMedium.woff') format('woff');
    font-weight: normal;
    font-style: normal;
}
@media (max-width: 992px) {
    .list-item {
        width: 48%; /* 화면이 작아지면 한 줄에 2개씩 배치됩니다. */
    }
}
#balloon {
    position: absolute;
    margin-top: -90px;
    top: 0;
    left: 0;
    z-index: 0;
}
#storybbsctt {
    position: absolute;
    z-index: 1; /* 풍선 이미지 위에 나타나도록 설정 */
}
.button-container {
    text-align: center;
    margin-top: 20px;
}
.button {
    padding: 10px 20px;
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
}
.grid-container {
    display: grid;
    grid-template-columns: auto auto auto;
    grid-gap: 10px;
    justify-content: center;
}
.list-container {
    justify-content: center;
    flex-wrap: wrap;
}
.list-item {
    width: 23%; /* 각 요소의 너비를 조절합니다. */
    float: left; /* 왼쪽으로 정렬합니다. */
    margin-bottom: 20px; /* 아래 여백을 줍니다. */
}
.list-item {
    overflow-y: auto;
}
.list-item img {
    width: 90%; 			/* 이미지를 부모 요소의 너비에 맞춥니다. */
    height: auto; 			/* 이미지의 비율을 유지합니다. */
    border-radius: 13px; 	/* 이미지의 모서리를 둥글게 만듭니다. */
    overflow: hidden;
}

.btn-clicked {
    background-color: #4CAF50;
    color: white;
}
.icon-container {
    display: inline-block;
    vertical-align: middle;
    margin-right: 5px;
}
.icon-container {
    display: inline-block;
    vertical-align: middle;
    margin-right: 5px; /* 아이콘과 텍스트 사이의 간격 조절 */
}
.dropdown-item.active, .dropdown-item:active {
/*     color: #fff; */
    text-decoration: none;
    background-color: #fff;
    color: inherit;
}
.btn-primary {
    background-color: rgba(75, 73, 172, 0.2);
    color: #4B49AC;
    background-image: none;
    border-color: rgba(75, 73, 172, 0);
}

</style>

<script>
$(document).ready(function() {

	// 	var totalPages      = ${total};
	var type ="";
	var keyword ="";
	
	// 정렬하기 위한 배열데이터
	let storyData       = [];
	let storySearchData = [];

	<% /* 최초 실행 */%>
	addPage("${param.currentPage}");
	
	const addBtn     = document.querySelector("#addBtn");
	const nowCnt     = document.querySelector("#nowCnt");
	const getCnt     = document.querySelector("#getCnt");
	const goodCnt    = document.querySelector("#goodCnt");
	const btnSearch  = document.querySelector("#btnSearch");
	
	console.log("storyData       : " + storyData);
	console.log("storySearchData : " + storySearchData);

	//start create click
	$("#create").on("click", function(){
		
		$.ajax({
			url : "/prostory/idCheck",
			method : "get",
			success : function(result){
				
				if(result === "not"){
					Swal.fire({
		                title: "로그인 후 이용하세요",
		                confirmButtonText: "확인",
		                icon: 'warning',
		                customClass: {
		                    title: 'swal-title'
		                }
		            });
					return;
				}
				
			}
			
		})
		
		location.href = "/prostory/write"
		
	});// end create click

	/* 좋아요순 정렬	*/	
	goodCnt.addEventListener("click", function() {
	    
	   	console.log("storyData 추천수 버튼:: " + storyData["proStoryBbscttRecommend"]);
	   	
	    storyData.sort((a, b) => b.proStoryBbscttRecommend - a.proStoryBbscttRecommend);

	    displaySortedData(storyData);
	    
	});// end goodCnt -> 좋아요순 정렬
	
	/* 조회수 정렬	*/	
	getCnt.addEventListener("click", function() {
	    
	   	console.log("storyData 조회수 버튼:: " + storyData["proStoryBbscttRdcnt"]);
	   	
	    storyData.sort((a, b) => b.proStoryBbscttRdcnt - a.proStoryBbscttRdcnt);

	    displaySortedData(storyData);
	   	
	});// end getCnt -> 조회수 정렬
	
	/* 최신순 정렬	*/	
	nowCnt.addEventListener("click", function() {
	    
	   	console.log("storyData 최신순 버튼:: " + storyData["proStoryBbscttWrDt"]);
	   	
	    storyData.sort((a, b) => new Date(b.proStoryBbscttWrDt) - new Date(a.proStoryBbscttWrDt));

	    displaySortedData(storyData);
	    
	});// end nowCnt -> 최신순 정렬
	
	/* 오래된순 정렬	*/	
	reverseNow.addEventListener("click", function() {
	    
	   	console.log("storyData 오래된순 버튼:: " + storyData["proStoryBbscttWrDt"]);
	   	
	   	storyData.sort((a, b) => new Date(a.proStoryBbscttWrDt) - new Date(b.proStoryBbscttWrDt));
		
	   	displaySortedData(storyData);
		
	});// end nowCnt -> 오래된순 정렬

	function displaySortedData(resultData) {
		
	    let str = "";
	    
	    for (let i = 0; i < resultData.length; i++) {
	    
	    	let story = resultData[i];
			     str += '<div class="list-item">';
			     str += '<ul class="text-center">';
			     str += '<li><img src="/images/' + story.proStoryBbscttThumbPhoto + '" /></li><br />';
			     str += '<li><a href="/prostory/getStory?storyNo=' + story.proStoryBbscttNo + '">' + story.proStoryBbscttSj + '</a></li>';
// 			     str += '<li>글번호 : ' + story.proStoryBbscttNo + '</li>';
//               str += '<li>' + story.proStoryBbscttWrDt.substring(0 , 10) + '</li>';
                 str += '<li>';
               	 str += '<img src="/resources/images/free-icon-like.png" alt="이미지" style="width:25px" > ' + story.proStoryBbscttRecommend + '&nbsp;&nbsp;';
                 str += '<img src="/resources/images/click.png" alt="이미지" style="width:25px"> ' + story.proStoryBbscttRdcnt + '</li>';
// 			     str += '<li>닉네임 : ' + story.userNcnm + '</li>';
// 			     str += '<li>아이디 : ' + story.userId + '</li>';
			     str += '</ul>';
			     str += '</div>';
	    }
	    document.getElementById('listContent').innerHTML = str;
	    applyStylesToNewItems();
	}
	
	// 드롭다운 & 검색 클릭 이벤트 핸들러
	document.querySelectorAll('.dropdown-item').forEach(item => {
	    
		item.addEventListener('click', event => {
	        // 클릭한 메뉴의 텍스트를 버튼에 적용
	        searchType = document.querySelector("#searchType").innerText = event.target.innerText;
	        // 다른 모든 메뉴 비활성화
	        document.querySelectorAll('.dropdown-item').forEach(item => {
	            item.classList.remove('active');
	        });
	        // 클릭한 메뉴 활성화
	        event.target.classList.add('active');
	
	        // 클릭한 메뉴에 따라 동작 수행
	        switch(event.target.id) {
	        
	            case "title":
	            	type = searchType;
	                console.log("제목 버튼 클릭 : " + type);
	                break;
	            case "content":
	            	type = searchType;
	                console.log("내용 버튼 클릭 : " + type);
	                break;
	            case "writer":
	            	type = searchType;
	                console.log("작성자 버튼 클릭 : " + type);
	                break;
	            default:
	        }
	    });
	});

	btnSearch.addEventListener("click" , function(){
	
		let currentPage = "${param.currentPage}"
		
		keyword = document.getElementById("searchKeyword").value;
		
		console.log("keyword : " + keyword);
		
		if(type==""){
			type = "제목";
		}
		
		if(keyword == ""){
			Swal.fire({
                title: "검색어를 입력하세요",
                confirmButtonText: "확인",
                icon: 'warning',
                customClass: {
                    title: 'swal-title'
                }
            });
			return;
		}
		console.log("type : " + type);
		
		let	data = { "currentPage":currentPage,
					 "keyword":keyword,
					 "type":type
					};
		
		console.log("type 여기서 값을 봐야 : " + type);
		console.log("currentPage 여기서 값을 봐야 : " + currentPage);
		console.log("keyword 여기서 값을 봐야 : " + keyword);
		$.ajax({
			url : "/prostory/getPage",
			type : "post",
			dataType : "json",
			data : data,			
			success : function(result , textStatus){
				console.log("test : " + result);
				
				let data = result.content;
				
				let str = "";
				
				$.each(data,function(idx,story){
					str += '<div class="list-item">';
					str += '<ul class="text-center">';
					str += '<li><img src="/images/' + story.proStoryBbscttThumbPhoto + '" /></li><br />';
					str += '<li><a href="/prostory/getStory?storyNo=' + story.proStoryBbscttNo + '">' + story.proStoryBbscttSj + '</a></li>';
// 					str += '<li>글번호 : ' + story.proStoryBbscttNo + '</li>';
// 					str += '<li>' + story.proStoryBbscttWrDt.substring(0 , 10) + '</li>';
					str += '<li>';
	               	str += '<img src="/resources/images/free-icon-like.png" alt="이미지" style="width:25px"> ' + story.proStoryBbscttRecommend + '&nbsp;&nbsp;';
	                str += '<img src="/resources/images/click.png" alt="이미지" style="width:25px"> ' + story.proStoryBbscttRdcnt + '</li>';
// 					str += '<li>닉네임 : ' + story.userNcnm + '</li>';
// 					str += '<li>아이디 : ' + story.userId + '</li>';
					str += '</ul>';
					str += '</div>';
							
					storyData.push(story);
					
				});// end for
	
				document.getElementById('listContent').innerHTML = str;
	// 			applyStylesToNewItems();
				$("#divPagingArea").html(result.pagingArea);
			}
		})
	})

	<% // start addPage function %>
	function addPage(currentPage){
		
		$.ajax({
			url : "/prostory/getPage",
			async : true,
			type : "post",
			dataType : "json",
			data : {"currentPage":currentPage},
			success : function(result , textStatus){
				
				let data = result.content;
	
				let str = "";
				
				//result : ArticlePage
				$.each(data , function(idx , story){
					str += '<div class="list-item">';
					str += '<ul class="text-center">';
					str += '<li><img src="/images/' + story.proStoryBbscttThumbPhoto + '" /></li><br />';
					str += '<li><a href="/prostory/getStory?storyNo=' + story.proStoryBbscttNo + '">' + story.proStoryBbscttSj + '</a></li>';
	// 				str += '<li>글번호 : ' + story.proStoryBbscttNo + '</li>';
	// 				str += '<li>' + story.proStoryBbscttWrDt.substring(0 , 10) + '</li>';
					str += '<li class="vertical-center">';
					str += '<img src="/resources/images/free-icon-like.png" alt="이미지" style="width:25px"> ' +story.proStoryBbscttRecommend + '&nbsp;&nbsp;';
					str += '<img src="/resources/images/click.png" alt="이미지" style="width:25px"> ' +story.proStoryBbscttRdcnt + '</li>';
	// 				str += " 조회수: " + story.proStoryBbscttRdcnt +  '</li>';
	// 				str += '<li>닉네임 : ' + story.userNcnm + '</li>';
	// 				str += '<li>아이디 : ' + story.userId + '</li>';
					str += '</ul>';
					str += '</div>';
							
					storyData.push(story);
				});// end for
	
				document.getElementById('listContent').innerHTML += str;
	// 			applyStylesToNewItems();
				$("#divPagingArea").html(result.pagingArea);
			}// end success
			
		})// end ajax
		
	}// end addPage

function applyStylesToNewItems() {
	
	   let newItems = document.querySelectorAll('.list-item');
	
	   newItems.forEach(function(item) {
// 			item.style.width = 'calc(33.33% - 10px)';
			item.style.margin = '5px';
			item.style.overflow = 'hidden';
	    });
	}
})
$(document).on('keydown', function(e){

	if (e.code == 'Enter' && !$('#tynQuickChatInput').is(':focus')) {
// 	       e.stopPropagation();
	       $('#btnSearch').click();
	   }
});
</script>
  <!-- 제목 -->
<div>
<div class="list-container" style="text-align: center;">
	<div class="container col-lg-5" style="text-align:center; position: absolute; top: 0; left: 0; width: 100%;">
    	<div>
	        <div style="position: relative;">
	        <img src="../resources/images/팻말8.png" id="balloon" style="opacity: 0.5; width: 500px; height:auto; margin:-40px 0 0 800px;">
	            <h3 id="storybbsctt" style="margin: 0 auto; text-align:center; font-family: 'seolleimcool-SemiBold'; color:#4e4c7c; text-shadow: -2px 0px white, 0px 2px white, 2px 0px white, 0px -2px white; display: inline-block; position: absolute; top: 200px;">프로의 특별한<br />이야기를 만나보세요</h3>
	        </div>
	    </div>
	</div>
		<br>
<div class="container col-lg-8">
	<br><br><br><br><br><br><br><br><br>
	
	<div class="d-flex justify-content-center align-items-center mb-3">
		<div class="dropdown" style="float: right; margin-right: 0">
			<button class="btn btn-inverse-primary btn-sm dropdown-toggle" type="button" id="searchType" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="margin-right: 10px;">제목</button>
			<input type="text" name="keyword" id="searchKeyword" value="${param.keyword}" style="width: 250px; border-radius: 15px; border: 0; outline: none; background-color: rgb(233, 233, 233); height: 30px; padding-left:11px; font-family: GmarketSansMedium; text-indent: 10px;">
			<button type="button" class="btn btn-inverse-primary btn-sm" id="btnSearch" style="margin-left: 10px;">
				<i class="mdi mdi-yeast"></i>
			</button>
			<div class="dropdown-menu" id="dropdown-menu2" aria-labelledby="dropdownMenuSizeButton3" style="min-width: 150px;">
				<p class="dropdown-item" id="title">제목</p>
				<p class="dropdown-item" id="content">내용</p>
				<p class="dropdown-item" id="writer">작성자</p>
			</div>
		</div>
        <c:if test="${memSession==null && proSession != null}">
            <button class="btn btn-inverse-primary btn-sm" type="button" id="create" style="margin-left: 10px;">글쓰기</button>
        </c:if>
	</div>
    <div class="d-flex justify-content-end align-items-center">
    </div>

	<div class="container col-lg-8 d-flex justify-content-center">
	    <nav class="scroll-hidden flex space-x-3 lg:space-x-8" aria-label="Tabs">
			<button id="nowCnt" class="btn btn-primary flex shrink-0 rounded-md px-3 py-2 text-sm font-medium sm:text-base sm:leading-5">최신순</button>
	        <button id="reverseNow" class="btn btn-primary flex shrink-0 rounded-md px-3 py-2 text-sm font-medium sm:text-base sm:leading-5" >오래된순</button>
			<button id="getCnt" class="btn btn-primary flex shrink-0 rounded-md px-3 py-2 text-sm font-medium sm:text-base sm:leading-5">조회수</button>
			<button id="goodCnt" class="btn btn-primary flex shrink-0 rounded-md px-3 py-2 text-sm font-medium sm:text-base sm:leading-5">좋아요</button>
	    </nav>
	</div>
</div>
	<br />	
	<br />
	
	<div class="list-container" id="listContent" style="display: flex; justify-content: center; ">
	</div>
</div>
<!--  -->
<div class="col-12 grid-margin stretch-card">
	<div class="card">
		<div class="card-body">
			<div id="divPagingArea" style="position: relative; margin-left: 48%; margin-top: 20px;"></div>
		</div>
	</div>
</div>
</div>
