<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<script type="text/javascript" src="/resources/js/jquery.min.js"></script>
<link rel="stylesheet" href="/resources/css/sweetalert2.min.css">
<link rel="stylesheet" href="/resources/css/mapApi.css">
<script src="/resources/js/sweetalert2.min.js"></script>

<style>
.innerDiv {
	height: auto;
/* 	text-align: center; */
}
.centerDiv{
	height: auto;
 	text-align: center;
}
.hrDiv {
	height: 30px;
	text-align: center;
}
tr{
	width:auto;
	height: auto;
}
.photoFile{
	width: 200px;
	height: 200px;
}
.profile{
	width: 40px;
	height: 40px;
	border-radius: 20px;
}
</style>
<script>
$(function(){
	$("#backBtn").on("click",function(){
		location.href="/onedayClass/main";
	})
	
	const sessionId = $("#sessionId").val();
	const classId = $("#classId").val();
	const str = `
		<button type="button" id="updateBtn" class="btn btn-inverse-primary btn-fw" style="float:right;">수정</button>
		<button type="button" id="deleteBtn" class="btn btn-inverse-dark btn-fw" style="float:right;">삭제</button>
	`;
	if(sessionId == classId){
		$(".btnPlus").append(str)
	}
	
	//원데이클래스 업데이트
	$("#updateBtn").on("click",function(){
		$("#updateForm").submit();
	})
	
	//원데이클래스 삭제
	$("#deleteBtn").on("click",function(){
		const classNo = $("#classNo").val();
		const fileNo = $("#fileNo").val();
		let today = new Date();
		let classDay = $("#classDay").val();

		let year = today.getFullYear(); // 년도
		let month = (today.getMonth() + 1).toString();  // 월
		console.log("classNo : " + classNo);
		if(month.length == 1){
			month = "0" + month;
		}
		
		let date = today.getDate();  // 날짜
		let sysdate = year+month+date;
		console.log(sysdate);
		console.log("3일 뺀 날짜 : " + (Number(classDay)-3));
		
		if(Number(sysdate) >= (Number(classDay)-3)){
			console.log("클래스 3일 이전")
			wal.fire({
				content: "input",
				title: "클래스 시작 3일전에는 클래스 삭제를 진행할 수 없습니다.",
				icon: 'error',
				showCancelButton: false,
	            confirmButtonColor: '#3085d6',
	            confirmButtonText: '확인',
				dangerMode: true,
			})
		}else{
			Swal.fire({
				content: "input",
				title: "원데이 클래스를 삭제하시겠습니까?",
				text: "삭제를 진행하려면 아래 '삭제진행' 을 입력해주세요.",
				input: 'text',
				icon: 'warning',
				showCancelButton: true,
	            confirmButtonColor: '#3085d6',
	            cancelButtonColor: '#d33',
	            confirmButtonText: '확인',
	            cancelButtonText: '취소'
// 				dangerMode: true
			})
			.then((result) => {
				if(result.value == "삭제진행"){ //삭제 진행 가능
					$.ajax({
			 			url:"/onedayClass/deleteClass?classNo=" + classNo,
			 			type:"get",
			 			success:function(res){
			 				Swal.fire({
					            title: '원데이클래스가 삭제되었습니다.',
					            icon: 'success',
					            showCancelButton: false,
					            confirmButtonColor: '#3085d6',
					            confirmButtonText: '확인'
					        })
			 			}
			 		})
				}else if(result.isDismissed){
					Swal.fire("원데이클래스 삭제 취소");
				}else{ //인증번호 틀리면
					Swal.fire({
			            title: '입력텍스트가 일치하지 않습니다.',
			            text: '입력텍스트가 일치하지 않으면 삭제를 진행하지 않습니다.',
			            icon: 'error',
			            showCancelButton: false,
			            confirmButtonColor: '#3085d6',
			            confirmButtonText: '확인'
			        })
				}
			});
		}
	}) //원데이클래스 삭제 끝
	
	$(document).on("click",".slideDiv button",function() {
        let slideDirection = $(this).attr("aria-label");
        if (slideDirection === "Previous slide") {
            plusSlides(-1); // 이전 슬라이드로 이동
        } else if (slideDirection === "Next slide") {
            plusSlides(1); // 다음 슬라이드로 이동
        }
    });
	
	// 슬라이드 쇼 함수
	let slideIndex = 0;
	showSlides();

	function plusSlides(n) {
		slideIndex += n;
		showSlides();
	}

	function showSlides() {
		console.log("왔다2");
		let slides = document.querySelectorAll(".slideDiv img");
		console.log("slides.length : " + slides.length);

		if (slideIndex >= slides.length) {
			slideIndex = 0
		}
		if (slideIndex < 0) {
			slideIndex = slides.length - 1
		}
		for (let i = 0; i < slides.length; i++) {
			slides[i].style.display = "none";
		}
		if (slides[slideIndex]) {
			slides[slideIndex].style.display = "block";
		} else {
		}
	}

})

</script>
<div class="container col-lg-10" style="padding:0px;">
	<div class="row col-lg-10">
		<h2 class="card-title">원데이클래스 상세페이지</h2>
		<button type="button" class="btn btn-inverse-primary btn-fw" style="float:right;">관심클래스 등록</button>
	</div>
	<hr>
</div>
<div class="container-fluid justify-content-center">
	<form action="/onedayClass/updateClass" method="post" id="updateForm">
		<c:if test="${not empty proSession}">
			<input type="hidden" id="sessionId" value="${proSession.userId}">
		</c:if>
		<input type="hidden" id="classId" name="proId" value="${vOndyclProUsersVO.proId}">
		<input type="hidden" id="classNo" name="ondyclNo" value="${vOndyclProUsersVO.ondyclNo}">
		<input type="hidden" id="fileNo" name="sprviseAtchmnflNo" value="${vOndyclProUsersVO.sprviseAtchmnflNo}">
		<input type="hidden" id="classDay" name="ondyclSchdulDe" value="${vOndyclProUsersVO.ondyclSchdulDe}">
		<input type="hidden" id="ondyclSchdulNo" name="ondyclSchdulNo" value="${vOndyclProUsersVO.ondyclSchdulNo}">
		<input type="hidden" id="ondyclNm" name="ondyclNm" value="${vOndyclProUsersVO.ondyclNm}">
		<input type="hidden" id="ondyclCn" name="ondyclCn" value="${vOndyclProUsersVO.ondyclCn}">
		<input type="hidden" id="ondyclPc" name="ondyclPc" value="${vOndyclProUsersVO.ondyclPc}">
		<input type="hidden" id="ondyclPsncpa" name="ondyclPsncpa" value="${vOndyclProUsersVO.ondyclPsncpa}">
		<input type="hidden" id="ondyclResvpa" name="ondyclResvpa" value="${vOndyclProUsersVO.ondyclResvpa}">
		<input type="hidden" id="ondyclThumbPhoto" name="ondyclThumbPhoto" value="${vOndyclProUsersVO.ondyclThumbPhoto}">
		<input type="hidden" id="ondyclSchdulBeginTime" name="ondyclSchdulBeginTime" value="${vOndyclProUsersVO.ondyclSchdulBeginTime}">
		<input type="hidden" id="ondyclSchdulEndTime" name="ondyclSchdulEndTime" value="${vOndyclProUsersVO.ondyclSchdulEndTime}">
	</form>
	<div class="row">
		<div class="innerDiv col-7">
			<div class="centerDiv co-10">
				<div class="slideDiv">
					<ul id="ulPrt">
						<c:if test="${not empty sprviseAtchmnflVOList[0].atchmnflCours}">
							<c:if test="${not empty sprviseAtchmnflVOList[1].atchmnflCours}">
								<li style="list-style-type: none; display: inline-block;">
									<button type="button" aria-label="Previous slide"
											style="background: none; margin-left: -15px; border: none; position: absolute; top: 30%;">
										<i class="mdi mdi-arrow-left-drop-circle-outline"
											style="font-size: 35px;"></i>
									</button>
								</li>
									<c:forEach var="imgFile" items="${sprviseAtchmnflVOList}" varStatus="stat">
										<li style='list-style-type: none; display: inline-block;'>
											<img src='${imgFile.atchmnflCours}'
												style='width: 400px; height: 400px; margin-left: 35px;'>
										</li>
									</c:forEach>
								<li style='list-style-type: none; display: inline-block;'>
									<button type='button' aria-label='Next slide'
										style='background: none; margin-left: 5px; border: none; position: absolute; top: 30%;'>
										<i class='mdi mdi-arrow-right-drop-circle-outline'
											style='font-size: 35px;'></i>
									</button>
								</li>
							</c:if>
							<c:if test="${empty sprviseAtchmnflVOList[1].atchmnflCours}">
								<li style='list-style-type: none; display: inline-block;'>
									<img src='${sprviseAtchmnflVOList.atchmnflCours}'
										style='width: 400px; height: 400px; margin-left: 35px;'>
								</li>
							</c:if>
						</c:if>
						<c:if test="${empty sprviseAtchmnflVOList[0].atchmnflCours}">
							<li style='list-style-type: none; display: inline-block;'>
								<img src='/images/2024/no_image.gif'
									style='width: 200px; height: 200px; margin-left: 35px;'>
							</li>
						</c:if>
					</ul>
				</div>
			</div>
			<div class="innerDiv co-10">
				${vOndyclProUsersVO.ondyclCn}
			</div>
		</div>
		<div class="innerDiv col-5">
			<div class="innerDiv co-10">
				<table class="table table-hover">
					<tbody>
						<tr>
							<td colspan='2'>
								<c:if test="${empty vOndyclProUsersVO.proProflPhoto}">
									<img class="profile" src="/images/2024/profile.jpg">
								</c:if>
								<c:if test="${not empty vOndyclProUsersVO.proProflPhoto}">
									<img class="profile" src="${vOndyclProUsersVO.proProflPhoto}">
								</c:if>
								${vOndyclProUsersVO.userNcnm}
							</td>
						</tr>
						<tr>
							<th>제목</th>
							<td>${vOndyclProUsersVO.ondyclNm}</td>
						</tr>
						<tr>
							<th>전문분야</th>
							<td>${vOndyclProUsersVO.spcltyRealmNm}</td>
						</tr>
						<tr>
							<th>시작일</th>
							<td>${vOndyclProUsersVO.ondyclSchdulDe}</td>
						</tr>
						<tr>
							<th>시간</th>
							<td>${vOndyclProUsersVO.ondyclSchdulBeginTime}~${vOndyclProUsersVO.ondyclSchdulEndTime}</td>
						</tr>
						<tr>
							<th>정원</th>
							<td>${vOndyclProUsersVO.ondyclResvpa} / ${vOndyclProUsersVO.ondyclPsncpa}</td>
						</tr>
						<tr>
							<th>가격</th>
							<td>${vOndyclProUsersVO.ondyclPc}</td>
						</tr>
						<tr>
							<td colspan='2' class="btnPlus"></td>
						</tr>
					</tbody>
				</table>
<%-- 				${vOndyclProUsersVO.userNcnm}<br> --%>
<%-- 				제목 : ${vOndyclProUsersVO.ondyclNm}<br> --%>
<%-- 				전문분야 : ${vOndyclProUsersVO.spcltyRealmNm}<br> --%>
<%-- 				시작일 : ${vOndyclProUsersVO.ondyclSchdulDe}<br> --%>
<%-- 				시간 : ${vOndyclProUsersVO.ondyclSchdulBeginTime}~${vOndyclProUsersVO.ondyclSchdulEndTime}<br> --%>
<%-- 				정원 : ${vOndyclProUsersVO.ondyclResvpa} / ${vOndyclProUsersVO.ondyclPsncpa}<br> --%>
<%-- 				가격 : ${vOndyclProUsersVO.ondyclPc} --%>
			</div>
			<div class="hrDiv co-10"></div>
			<div class="innerDiv co-10">지도가 들어가면 딱좋겠네 정말 좋겠네</div>
			<div class="hrDiv co-10"></div>
			<div class="innerDiv col-10">
				<button type="button" id="backBtn" class="btn btn-inverse-dark btn-fw" style="float:right;">목록으로</button>
				<button type="button" class="btn btn-inverse-primary btn-fw" style="float:right;">구매</button>
			</div>
		</div>
	</div>
</div>
