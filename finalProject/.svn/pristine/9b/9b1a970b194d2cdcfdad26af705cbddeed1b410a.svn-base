<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.board.review_board.mapper.ReviewBoardMapper">

	<select id="list" parameterType="hashMap" resultType="aftusBbscttVO">
		SELECT
		A.AFTUS_BBSCTT_NO, A.AFTUS_BBSCTT_SJ, A.AFTUS_BBSCTT_WR_DT, B.USER_NCNM
		FROM AFTUS_BBSCTT A, USERS B
		WHERE B.USER_ID=A.USER_ID AND 1 = 1
		<if test="keyword!=null and keyword!=''">
			AND (
					A.AFTUS_BBSCTT_SJ LIKE '%' || #{keyword} || '%'
			)
		</if>
		ORDER BY A.AFTUS_BBSCTT_NO DESC
	</select>
	
	<select id="listModal" parameterType="String" resultType="srvcRequstVO">
		SELECT DISTINCT A.SRVC_REQUST_NO, A.SRVC_REQUST_SJ, A.SRVC_REQUST_WR_DT, A.SRVC_REQUST_COMPT_DT 
		FROM SRVC_REQUST A, AFTUS_BBSCTT B
		WHERE A.SRVC_REQUST_PROCESS_AT=3 AND A.MBER_ID=#{userId} AND
		NOT EXISTS(
			SELECT B.SRVC_REQUST_NO FROM AFTUS_BBSCTT B 
			WHERE A.SRVC_REQUST_NO = B.SRVC_REQUST_NO
		)
	</select>
	
	<select id="listMyReview" parameterType="String" resultType="AftusBbscttVO">
		SELECT
		A.AFTUS_BBSCTT_NO, A.AFTUS_BBSCTT_SJ, A.AFTUS_BBSCTT_WR_DT, B.USER_NCNM
		FROM AFTUS_BBSCTT A, USERS B
		WHERE A.USER_ID=B.USER_ID AND A.USER_ID=#{userId}
	</select>
	
	
	<select id="detail" parameterType="int" resultType="aftusBbscttVO">
		SELECT
		A.AFTUS_BBSCTT_NO, A.AFTUS_BBSCTT_SJ, A.AFTUS_BBSCTT_CN, A.AFTUS_BBSCTT_WR_DT
			, A.AFTUS_BBSCTT_RDCNT, A.SPRVISE_ATCHMNFL_NO, A.SRVC_REQUST_NO, A.USER_ID, B.USER_NCNM
		FROM AFTUS_BBSCTT A, USERS B
		WHERE B.USER_ID=A.USER_ID AND A.AFTUS_BBSCTT_NO=#{aftusBbscttNo}
	</select>
	
	<insert id="createAjax" parameterType="aftusBbscttVO">
    	<selectKey keyProperty="aftusBbscttNo" resultType="int" order="BEFORE">
        	SELECT AFTUS_BBSCTT_NO_seq.nextval FROM DUAL
    	</selectKey>
    	INSERT INTO AFTUS_BBSCTT (AFTUS_BBSCTT_NO, AFTUS_BBSCTT_SJ, AFTUS_BBSCTT_CN
    		, AFTUS_BBSCTT_WR_DT, AFTUS_BBSCTT_RDCNT, SPRVISE_ATCHMNFL_NO, SRVC_REQUST_NO, USER_ID)
    	VALUES (#{aftusBbscttNo}, #{aftusBbscttSj}, #{aftusBbscttCn}, SYSDATE, #{aftusBbscttRdcnt}
    	, SPRVISE_ATCHMNFL_NO_seq.nextval, #{srvcRequstNo}, #{userId})
    	
	</insert>
	
	<insert id="insertFile" parameterType="sprviseAtchmnflVO">
		INSERT INTO SPRVISE_ATCHMNFL(SPRVISE_ATCHMNFL_NO, ATCHMNFL_NO, ATCHMNFL_COURS
			, ATCHMNFL_NM, STORE_ATCHMNFL_NM, ATCHMNFL_TY, REGIST_DT, USER_ID)
		VALUES (SPRVISE_ATCHMNFL_NO_seq.currval, #{atchmnflNo}, #{atchmnflCours}, #{atchmnflNm}, #{storeAtchmnflNm}, #{atchmnflTy}, SYSDATE, #{userId})
	</insert>
	

	<delete id="delete" parameterType="int">
		DELETE FROM AFTUS_BBSCTT
		WHERE AFTUS_BBSCTT_NO=#{aftusBbscttNo}
	</delete>
	
</mapper>