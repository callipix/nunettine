<%@ page language="java" contentType="text/html; charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %>
<script type="text/javascript" src="/resources/js/jquery.min.js"></script>


<head>
<title>프로 프로필</title>
</head>

<script>
$(document).ready(function(){
    $("#bcityNm").change(function(){
        var selecBcity = $(this).val(); // 선택된 광역시 이름
        var brtcOptions = ""; // 시/구 옵션을 저장할 변수
        
        $.ajax({
            type: "GET",
            url: "/proProfl/brtcList",
            data: { bcityNm: selecBcity },
            success: function(data){
                $.each(data, function(index, list){
                     brtcOptions += '<option value="' + list.brtcNm + '">' + list.brtcNm + '</option>';
                });
                $("#brtcNm").html('<option selected>지역(시/구)</option>' + brtcOptions);
            },
            error: function(xhr, status, error) {
                console.log("Error: " + error);
            }
        });
    });
});

$(function(){
	
	$("#frm").submit(function(event){
		// 엔터를 <br> 태그로 변환
		var reqFormText = document.getElementById("proProflReqForm").value;
		var histText = document.getElementById("proProflHist").value;

		reqFormText = reqFormText.replace(/(?:\r\n|\r|\n)/g, '<br>');
		histText = histText.replace(/(?:\r\n|\r|\n)/g, '<br>');

		// 변환된 텍스트를 다시 해당 요소에 적용
		document.getElementById("proProflReqForm").value = reqFormText;
		document.getElementById("proProflHist").value = histText;
		
		var proProflOnLiIntrcn = $("#proProflOnLiIntrcn").val();
		if (!proProflOnLiIntrcn || proProflOnLiIntrcn.trim() == "") {
		    alert("프로필 한줄 소개를 적어주세요");
		    $("#proProflOnLiIntrcn").focus();
		    return false;
		}
		var proProflContactPosblTime = $("#proProflContactPosblTime").val();
		if(!proProflContactPosblTime || proProflContactPosblTime.trim()==""){
			alert("연락 가능 시간을 적어주세요");
			$("#proProflContactPosblTime").focus();
			return false;
		}
		var proProflReqForm = $("#proProflReqForm").val();
		if(!proProflReqForm || proProflReqForm.trim()==""){
			alert("요청시 양식을 적어주세요");
			$("#proProflReqForm").focus();
			return false;
		}
		var proProflHist = $("#proProflHist").val();
		if(!proProflHist || proProflHist.trim()==""){
			alert("프로 상세 이력을 적어주세요");
			$("#proProflHist").focus();
			return false;
		}
		
		var brtcNm = $("#brtcNm").val();
		if (!brtcNm || brtcNm == "지역(시/구)") {
		    alert("지역을 선택해주세요");
		    $("#brtcNm").focus();
		    return false;
		}
	
	});

});
</script>
<!-- 
요청URI : /createPost
요청파라미터 : {PRO_ID=protest100, PRO_PROFL_ON_LI_INTRCN=반려동물 산책/돌봄 자신있습니다, PRO_PROFL_CONTACT_POSBL_TIME=10:00 ~ 21:00, 
              PRO_PROFL_REQ_FORM=반려동물 이름:  종류: , PRO_PROFL_HIST=반려견 산책대회 우승자, BCITY_CODE=25, BRTC_CODE=25030}
요청방식 : post
 -->
<input type="hidden" id="sessionId" value="${proSession.userId}" />
<h1>프로프로필</h1>
<br>
<form id="frm" name="frm" action="/proProfl/createPost" method="post" >
 	<div class="mb-3">   
		<div class="form-group">
		   <label for="proId">프로 아이디</label>
		   <input type="text" id="proId" name="proId" value="${proSession.userId}" class="form-control" readonly/>
		</div>
		<div class="form-group">
		   <label for="proProflOnLiIntrcn">한줄소개</label>
		   <input type="text" id="proProflOnLiIntrcn" name="proProflOnLiIntrcn" class="form-control" />
		</div>
		<div class="form-group">
			<label for="proProflContactPosblTime">연락 가능 시간</label>
			<input type="text" name="proProflContactPosblTime" id="proProflContactPosblTime" class="form-control" placeholder="예) 9:00 ~ 10:00" />
		</div>
		<div class="form-group">
			<label for="proProflReqForm">요청서 양식</label>
			<textarea id="proProflReqForm" name="proProflReqForm" class="form-control"></textarea>
		</div>
		<div class="form-group">
			<label for="proProflHist">프로 이력</label>
			<textarea id="proProflHist" name="proProflHist" class="form-control"></textarea>
		</div> 
		<div class="form-group">
			<label for="bcityNm">지역(광역시)</label>
			   <select id="bcityNm" name="bcityNm" class="form-control">
			      <option selected>지역(광역시)</option>
			      <c:forEach items="${bcityVOList}" var="bcityVO">
			         <option><c:out value="${bcityVO.bcityNm}"/></option>
			      </c:forEach>
			   </select>
		</div> 
		<div class="form-group">
			<label for="brtcNm">지역(시/구)</label>
				<select id="brtcNm" name="brtcNm" class="form-control">
				    <option selected>지역(시/구)</option>
				</select>
		</div>
      
      <div class="form-group">
         <input type="submit" class="btn btn-outline-primary btn-fw" value="등록하기">
         <button onclick="history.back()" class="btn btn-outline-secondary btn-fw">뒤로가기</button>
      </div>
   </div>
</form>