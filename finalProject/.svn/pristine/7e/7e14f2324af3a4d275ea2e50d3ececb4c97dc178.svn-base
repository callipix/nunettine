<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<link rel="stylesheet" href="/resources/css/sweetalert2.min.css">
<script src="/resources/js/sweetalert2.min.js"></script>
<script type="text/javascript" src="/resources/js/jquery.min.js"></script>
<style>
.sidenav {
	width: 200px;
	position: fixed;
	z-index: 1;
	font-size: 0.5rem;
	top: 300px;
	left: 10px;
	border-bottom: 1px solid lightgray;
	overflow-x: hidden;
	padding: 8px 0;
}
.sidenav p {
	padding: 6px 8px 6px 16px;
	text-decoration: none;
	font-size: 18px;
	display: block;
}
.sidenav a {
	padding: 6px 8px 6px 16px;
	text-decoration: none;
	font-size: 18px;
	color: #2196F3;
	display: block;
}

.sidenav a:hover {
	color: #064579;
}

.main {
	margin-left: 140px; /* Same width as the sidebar + left position in px */
	font-size: 10px; /* Increased text to enable scrolling */
	padding: 0px 10px;
}

@media screen and (max-height: 450px) {
	.sidenav {padding-top: 15px;}
	.sidenav a {font-size: 10px;}
}
</style>
<script>
function pagingList(data){
	let bool = $('#pastTime').is(':checked');
	$.ajax({
		url : "/onedayClass/memberOndyclListAjax",
		type : "post",
		data : JSON.stringify(data),
		contentType: "application/json;charset=utf-8",
		dataType:"json",
		success : function(res){
			console.log("res:",res);
			if(res.total == 0){
				alert("검색 결과가 하나도 없습니다.");
			}
			let date = new Date();
			let today = date.getFullYear().toString() +"."+ String(date.getMonth() + 1).padStart(2,"0") +"."+ String(date.getDate()).padStart(2,"0");
			let threeDay = new Date(date.setDate(date.getDate() + 3));
			let thirdDate = date.getFullYear().toString() +"."+ String(date.getMonth() + 1).padStart(2,"0") +"."+ String(date.getDate()).padStart(2,"0");
			let str = "";
			
			$("#myClassTbody").html("");
			
			$.each(res.content,function(idx, vOndyclProUsersVO){
				if(bool){//수강 완료만 보기
					if(vOndyclProUsersVO.dayCheck){
						str += "<tr style=\"cursor: pointer;\">";   
						str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=myClass'\">"+vOndyclProUsersVO.rnum+"</td>";
						str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=myClass'\">"+vOndyclProUsersVO.ondyclNm+"</td>";
						str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=myClass'\">"+vOndyclProUsersVO.ondyclSchdulDe+"</td>";
						str += "<td><button type='button' class='btn btn-success btn-rounded btn-fw btn-sm'>리뷰쓰기</button></td>";
						str += "</tr>";
					}
				}else{
					str += "<tr style=\"cursor: pointer;\">";   
					str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=myClass'\">"+vOndyclProUsersVO.rnum+"</td>";
					str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=myClass'\">"+vOndyclProUsersVO.ondyclNm+"</td>";
					str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=myClass'\">"+vOndyclProUsersVO.ondyclSchdulDe+"</td>";
					if(vOndyclProUsersVO.dayCheck){ //시간 지남.
						str += "<td><button type='button' class='btn btn-success btn-rounded btn-fw btn-sm'>리뷰쓰기</button></td>";
					}else{ //시간 지나기 전
						str += "<td><button type='button' class='btn btn-danger btn-rounded btn-fw btn-sm'>취소</button></td>";
					}
					str += "</tr>";
				}
				
// 				str += "<tr onclick=\"location.href='/onedayclass/onedayclassdetail?ondyclno=" + vondyclprousersvo.ondyclno + "&startpoint=myclass'\" style=\"cursor: pointer;\">";   
// 				str += "<td>"+vondyclprousersvo.rnum+"</td>";
// 				str += "<td>"+vondyclprousersvo.ondyclnm+"</td>";
// 				str += "<td>"+vondyclprousersvo.ondyclschdulde+"</td>";
// 				str += "<td>버튼</td>";
// 				str += "</tr>";
			
			
			});
			$("#myClassTbody").append(str);
// 			$("#keyword").val("");
// 			console.log("여기요 : ",res.pagingArea);
			$("#divPagingArea").html(res.pagingArea);
// 			sessionStorage.setItem("total",res.total);
		}
	});
}
$(document).ready(function(){
	//검색조건 제목
	$("#title").on("click",function(){
		const btnElement = document.getElementById('searchCategory');
		btnElement.innerText = '제목';
		$('#keyword').attr("type", "text");
		$("#searchKeyword").val("title");
		$("#keyword").val("");
	})
	//검색조건 날짜
	$("#date").on("click",function(){
		const btnElement = document.getElementById('searchCategory');
		btnElement.innerText = '날짜';
		$('#keyword').attr("type", "date");
		$("#searchKeyword").val("date");
		$("#keyword").val("");
	})
	
	let searchKeyword = $("#searchKeyword").val();
	let userId = $("#sessionId").val();
	if($("#sessionId").val() == ""){
		alert("로그인 후 이용해주세요.");
		location.href="/main";
	}
	
	$("#btnSearch").on("click",function(){
		let keyword = $("#keyword").val();
		let currentPage = "1";
		let searchKeyword = $("#searchKeyword").val();
		
		let data = {
			"keyword":keyword,
			"currentPage":currentPage,
			"mberId":userId,
			"searchKeyword":searchKeyword
		};
		console.log("data:"+data)
		pagingList(data);
	});
	
	let currentPage  = "${param.currentPage}";
	if(currentPage==""){
		currentPage = 1;
	}
	
	let data = {
		"keyword":"${param.keyword}",
		"currentPage":currentPage,
		"mberId":userId,
		"searchKeyword":searchKeyword
	};
	console.log("data2:",data)
	pagingList(data);
	
	$("#pastTime").on("click",function(){
		let bool = $('#pastTime').is(':checked');
		let keyword = $("#keyword").val();
		let currentPage = "1";
		let searchKeyword = $("#searchKeyword").val();
		
		let data = {
			"keyword":keyword,
			"currentPage":currentPage,
			"mberId":userId,
			"searchKeyword":searchKeyword
		};
		console.log(bool);
		if(bool){ //수강 완료만 보기
			$.ajax({
				url : "/onedayClass/memberOndyclListAjax",
				type : "post",
				data : JSON.stringify(data),
				contentType: "application/json;charset=utf-8",
				dataType:"json",
				success : function(res){
					console.log("res:",res);
					if(res.total == 0){
						alert("검색 결과가 하나도 없습니다.");
					}
					let date = new Date();
					let today = date.getFullYear().toString() +"."+ String(date.getMonth() + 1).padStart(2,"0") +"."+ String(date.getDate()).padStart(2,"0");
					let threeDay = new Date(date.setDate(date.getDate() + 3));
					let thirdDate = date.getFullYear().toString() +"."+ String(date.getMonth() + 1).padStart(2,"0") +"."+ String(date.getDate()).padStart(2,"0");
					let str = "";
					
					$("#myClassTbody").html("");
					
					$.each(res.content,function(idx, vOndyclProUsersVO){
						if(vOndyclProUsersVO.dayCheck){
							str += "<tr style=\"cursor: pointer;\">";   
							str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=myClass'\">"+vOndyclProUsersVO.rnum+"</td>";
							str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=myClass'\">"+vOndyclProUsersVO.ondyclNm+"</td>";
							str += "<td onclick=\"location.href='/onedayClass/onedayClassDetail?ondyclNo=" + vOndyclProUsersVO.ondyclNo + "&startPoint=myClass'\">"+vOndyclProUsersVO.ondyclSchdulDe+"</td>";
							str += "<td><button type='button' class='btn btn-success btn-rounded btn-fw btn-sm'>리뷰쓰기</button></td>";
							str += "</tr>";
						}
					});
					if(str == ""){
						alert("검색조건 중 수강 완료한 클래스가 존재하지 않습니다.");
					}
					$("#myClassTbody").append(str);
// 					$("#keyword").val("");
					$("#divPagingArea").html(res.pagingArea);
				}
			});
		}else{ //수강전인것만
			let keyword = $("#keyword").val();
			let currentPage = "1";
			let searchKeyword = $("#searchKeyword").val();
			
			let data = {
				"keyword":keyword,
				"currentPage":currentPage,
				"mberId":userId,
				"searchKeyword":searchKeyword
			};
			console.log("data:"+data)
			pagingList(data);
		}
		
	})
})
</script>
<input type="hidden" id="sessionId" value="${memSession.userId}" />
<div class="col-md-12 stretch-card grid-margin grid-margin-md-0">
	<div class="card data-icon-card-primary">
		<div class="card-body">
			<p class="card-title text-white"></p>
			<div class="row">
				<div class="col-8 text-white">
					<h3>원데이클래스 관리입니다.</h3>
					<p class="text-white font-weight-500 mb-0">This is a ondayclass list you reserved before.</p>
				</div>
				<div class="col-4 background-icon"></div>

			</div>
		</div>
	</div>
</div>

<div class="sidenav">
	<p style="text-align:center;"><b>마이페이지 메뉴</b></p><hr>
	<a href="/member/memberMypage">마이페이지</a>
	<a href="/srvcBtfInqry/btfInqryList">보낸 서비스 문의 내역</a>
	<a href="/srvcRequst/srvcRqList">보낸 서비스 요청 내역</a>
	<a href="/member/memberOndyclList">원데이클래스</a>
	<a href="/member/memberPostList">게시글 관리</a>
	<a href="#">리뷰 관리</a>
	<a href="#">1:1 문의 내역</a>
</div>

<div class="col-lg-12 grid-margin stretch-card">
<input type="hidden" id="searchKeyword" value="title">
	<div class="card">
		<div class="card-body">
			<div class="row">
				<div class="col-md-6" style="margin-top: 10px;">
					<h3>원데이클래스 예약내역</h3>
					<p class="font-weight-500 mb-0" style="color: red">※클래스 시작 3일전부터는 클래스를 취소할 수 없습니다.</p>
				</div>
				<div class="col-md-6 form-group text-center"> <!-- 중앙 정렬을 위해 text-center 클래스 추가 -->
					<input type="checkbox" id="pastTime" value="pastTime">수강 완료한 클래스만 보기
					<div class="input-group">
						<button class="btn btn-inverse-primary btn-fw btnSelect dropdown-toggle"
							type="button" id="searchCategory" data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="false">제목</button>
						<div class="dropdown-menu" style="">
							<a class="dropdown-item" href="#" id="title">제목</a>
							<a class="dropdown-item" href="#" id="date">날짜</a>
						</div>
						<input type="text" name="keyword" id="keyword" value="${param.keyword}" class="form-control" placeholder="검색어를 입력하세요" aria-label="">
						<div class="input-group-append">
							<button class="btn btn-sm btn-primary" id="btnSearch" type="button">
							Search <i class="fas fa-se	arch"></i>
							</button>
						</div>
					</div>
				</div>
			</div>
			<div class="table-responsive">
				<table class="table table-hover">
					<thead>
						<tr class="text-white" style="background-color: #4b49ac">
							<th style="width: 10%;">글번호</th>
							<th style="width: 50%;">제목</th>
							<th style="width: 10%;">진행일자</th>
							<th style="width: 10%;">취소버튼</th>
						</tr>
					</thead>
					<tbody id="myClassTbody">
						<!-- 공지사항 내용이 표시되는 부분 -->
					</tbody>
				</table>
			</div>
			<div class="row justify-content-center" style="margin-top: 20px;">
				<div id="divPagingArea"></div>
			</div>
		</div>
	</div>
</div>