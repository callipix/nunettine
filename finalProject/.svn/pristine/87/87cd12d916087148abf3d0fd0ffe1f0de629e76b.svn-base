package kr.or.ddit.board.review_board.controller;

import java.util.List;
import java.util.Map;

import javax.inject.Inject;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.MultipartHttpServletRequest;

import kr.or.ddit.board.freeboard.controller.UploadController;
import kr.or.ddit.board.review_board.service.ReviewBoardService;
import kr.or.ddit.vo.AftusBbscttVO;
import kr.or.ddit.vo.SrvcRequstVO;
import lombok.extern.slf4j.Slf4j;

@Slf4j
@Controller
@RequestMapping("/reviewBoard")
public class ReviewBoardController {
	
	@Inject
	ReviewBoardService reviewBoardService;
	
	@Inject
	String uploadFolderDirect;
	@Inject
	MultipartHttpServletRequest request;
	
	@Inject
	UploadController uploadController;

	
	@GetMapping("/main")
	public String main() {
		
		return "reviewBoard/index";
	}
	
//	@GetMapping("/list")
//	public String list(Model model, Map<String,Object> map) {
//		
//		List<AftusBbscttVO> aftusBbscttVoList = this.reviewBoardService.list(map);
//
//		
//		model.addAttribute("aftusBbscttVoList", aftusBbscttVoList);
//		
//		
//		log.info("list -> aftusBbscttVoList" + aftusBbscttVoList);
//
//		//forwarding : jsp
//		return "reviewBoard/index";
//	}
	
	@ResponseBody
	@PostMapping("/listAjax")
	public List<AftusBbscttVO> listAjax (@RequestBody(required=false) Map<String, Object> map) {
		
		log.info("list -> map : " + map);
		
		List<AftusBbscttVO> aftusBbscttVoList = this.reviewBoardService.list(map);
		
		log.info("list -> aftusBbscttVoList" + aftusBbscttVoList);
		
		return aftusBbscttVoList;
	}
	
	@ResponseBody
	@PostMapping("/listModal")
	public List<SrvcRequstVO> listModal (String userId) {
		
		userId="a002";
		
		List<SrvcRequstVO> SrvcRequstVOList = this.reviewBoardService.listModal(userId);
		
		log.info("listModal -> SrvcRequstVOList" + SrvcRequstVOList);
		
		return SrvcRequstVOList;
	}
	
	@ResponseBody
	@PostMapping("/listMyReview")
	public List<AftusBbscttVO> listMyReview (String userId) {
		
		userId="a002";
		
		List<AftusBbscttVO> aftusBbscttVoList = this.reviewBoardService.listMyReview(userId);
		
		log.info("listMyReview -> AftusBbscttVOList" + aftusBbscttVoList);
		
		return aftusBbscttVoList;
	}
	
	

	@GetMapping("/create") 
	public String create(int srvcRequstNo,
						Model model) { 
		//@request param 안 써도 됨!
		log.info("srvcRequstNo" + srvcRequstNo);
		model.addAttribute("srvcRequstNo", srvcRequstNo); 
		
		return "reviewBoard/create"; }

	
//	@GetMapping("/create")
//	public String create() {
//		log.info("보이냐");
//		return "reviewBoard/create";
//	}
	
	
	@PostMapping("/create")
	public String create(AftusBbscttVO aftusBbscttVO) {
		
		String userId="a002";
		aftusBbscttVO.setUserId(userId);
		
		log.info("create -> aftusBbscttVO : " + aftusBbscttVO);
		int result = this.reviewBoardService.create(aftusBbscttVO);
		log.info("create -> result : " + result);
		
		return "Redirect:reviewBoard/detail?aftusBbscttNo=" + aftusBbscttVO.getAftusBbscttNo();
	}
	
	@ResponseBody
	@PostMapping("/createAjax")
	public int createAjax(AftusBbscttVO aftusBbscttVO) {
		
		String userId="a002";
		aftusBbscttVO.setUserId(userId);
		
		
		log.info("create -> aftusBbscttVO : " + aftusBbscttVO);
		
		log.info("createAjax -> aftusBbscttVO : " + aftusBbscttVO);
		int result = this.reviewBoardService.createAjax(aftusBbscttVO);
		
		log.info("createAjax -> result : " + result);
		
		
		
		return aftusBbscttVO.getAftusBbscttNo();
	}
	
	@GetMapping("/detail")
	public String detail(int aftusBbscttNo, Model model) {
		
		log.info("detail -> aftusBbscttNo : " + aftusBbscttNo);
	
		
		int result = this.reviewBoardService.updateCnt(aftusBbscttNo);
		
		log.info("cnt result : " + result);
		
		AftusBbscttVO aftusBbscttVO = this.reviewBoardService.detail(aftusBbscttNo);
		

		log.info("detail -> aftusBbscttVO : " + aftusBbscttVO);
		
		model.addAttribute(aftusBbscttVO);
		
		return "reviewBoard/detail";
	}
	
	@ResponseBody
	@PostMapping("/delete")
	public int delete(int aftusBbscttNo) {
		
		log.info("aftusBbscttNo" + aftusBbscttNo);
		
		int result = this.reviewBoardService.delete(aftusBbscttNo);
		
		log.info("result" + result);
		
		return result;
		
	}
	
	@PostMapping("/update")
	public String update(AftusBbscttVO aftusBbscttVO) {
		
		log.info("update -> aftusBbscttVO : " + aftusBbscttVO);
		
		int result = this.reviewBoardService.update(aftusBbscttVO);
		
		
		return "redirect:reviewBoard/detail?aftusBbscttNo=" + + aftusBbscttVO.getAftusBbscttNo();
	}
	
	
	
	
	
}
